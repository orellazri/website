<!DOCTYPE html>

<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="color-scheme" content="light dark">
  
  
    
  
  <meta name="description" content="">

  <title>Empowering Developers with Self-Serve GitLab CI&#x2F;CD Templates</title>
  <link rel="icon" type="image/png" sizes="32x32" href="https://orellazri.com/img/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://orellazri.com/img/favicon-16x16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="https://orellazri.com/img/apple-touch-icon.png">
  <style>
@font-face {
  font-display: swap;
  font-family: 'Piazzolla';
  font-style: normal;
  font-weight: 400;
  src: url('/font/Piazzolla.woff2') format('woff2');
}
</style>

  <style>

  /* light mode colors */
  body {
    --primary-color: #5871a2;
    --primary-pale-color: #5871a233;
    --primary-decoration-color: #5871a210;
    --bg-color: #ffffff;
    --text-color: #2f3030;
    --text-pale-color: #767676;
    --text-decoration-color: #a9a9a9;
    --highlight-mark-color: #5f75b020;

    --callout-note-color: #5871a2;
    --callout-tip-color: #268556;
    --callout-important-color: #885fc9;
    --callout-warning-color: #ab6632;
    --callout-caution-color: #c64e4e;
  }

  /* dark mode colors */
  body.dark {
    --primary-color: #6f8fd1;
    --primary-pale-color: #6f8fd166;
    --primary-decoration-color: #6f8fd112;
    --bg-color: #2b2b38;
    --text-color: #c1c1c1;
    --text-pale-color: #848484;
    --text-decoration-color: #5f5f5f;
    --highlight-mark-color: #8296cb3b;

    --callout-note-color: #6f8fd1;
    --callout-tip-color: #47976f;
    --callout-important-color: #9776cd;
    --callout-warning-color: #ad7a52;
    --callout-caution-color: #d06161;
  }

  /* typography */
  body {
    --main-font: 'Piazzolla', serif;
    --code-font: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;
    --homepage-max-width: 768px;
    --main-max-width: 768px;
    --avatar-size: 50px;
    --font-size: 17px;
    --line-height: 1.75;
    --img-border-radius: 0px;
    --detail-border-radius: 0px;
    --dark-mode-img-brightness: 0.75;
    --dark-mode-chart-brightness: 0.75;
    --inline-code-border-radius: 2px;
    --inline-code-bg-color: var(--primary-decoration-color);
    --block-code-border-radius: 0px;
    --block-code-border-color: var(--primary-color);
    --detail-border-color: var(--primary-color);
  }

</style>

  <link rel="stylesheet" href="https://orellazri.com/main.css">
  

<link id="hl" rel="stylesheet" type="text/css" href="/giallo-dark.css" />



  <script data-goatcounter="https://orellazri.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>

</head>

<body class="post dark">
  
  
<div id="wrapper">
  <div id="blank"></div>
  <aside>
    
    
    <nav>
      <ul>
        
        <li>
          <a class="h2" href="#the-power-of-gitlab-ci-cd-templates">The Power of GitLab CI&#x2F;CD Templates</a>
          
        </li>
        
        <li>
          <a class="h2" href="#the-inner-workings">The Inner Workings</a>
          
        </li>
        
        <li>
          <a class="h2" href="#example-of-using-templates">Example of Using Templates</a>
          
        </li>
        
        <li>
          <a class="h2" href="#self-documenting-system">Self-Documenting System</a>
          
        </li>
        
      </ul>
    </nav>
    
    
    <button id="back-to-top" aria-label="back to top">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-up"><line x1="12" y1="19" x2="12" y2="5"></line><polyline points="5 12 12 5 19 12"></polyline></svg>

    </button>
    
  </aside>
  <main>
    
<header>
  <nav>
    <a id="back-link" href="https:&#x2F;&#x2F;orellazri.com&#x2F;posts">‚Üê Back</a>
  </nav>
</header>


    <div>
      
      
      
      
      <div id="copy-cfg" style="display: none;" data-copy-icon="&lt;svg xmlns=&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2000&#x2F;svg&quot; viewBox=&quot;0 0 24 24&quot; width=&quot;18&quot; height=&quot;18&quot;&gt;&lt;path d=&quot;M6.9998 6V3C6.9998 2.44772 7.44752 2 7.9998 2H19.9998C20.5521 2 20.9998 2.44772 20.9998 3V17C20.9998 17.5523 20.5521 18 19.9998 18H16.9998V20.9991C16.9998 21.5519 16.5499 22 15.993 22H4.00666C3.45059 22 3 21.5554 3 20.9991L3.0026 7.00087C3.0027 6.44811 3.45264 6 4.00942 6H6.9998ZM5.00242 8L5.00019 20H14.9998V8H5.00242ZM8.9998 6H16.9998V16H18.9998V4H8.9998V6Z&quot; fill=&quot;currentColor&quot;&gt;&lt;&#x2F;path&gt;&lt;&#x2F;svg&gt;
" data-check-icon="&lt;svg xmlns=&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2000&#x2F;svg&quot; viewBox=&quot;0 0 24 24&quot; width=&quot;18&quot; height=&quot;18&quot;&gt;&lt;path d=&quot;M10.0007 15.1709L19.1931 5.97852L20.6073 7.39273L10.0007 17.9993L3.63672 11.6354L5.05093 10.2212L10.0007 15.1709Z&quot; fill=&quot;currentColor&quot;&gt;&lt;&#x2F;path&gt;&lt;&#x2F;svg&gt;
"></div>
      
      <article class="prose">
        <h1>Empowering Developers with Self-Serve GitLab CI&#x2F;CD Templates</h1>
        <div id="post-info">
          <div id="date">
            <span id="publish">Nov 23, 2024</span>
            </div>

          
          <div id="tags">
            <a class="instant" href="https://orellazri.com/tags/devops"><span>#</span>devops</a>
          </div>
          
        </div>

        
        

        

        <p>Empowering developers to manage their own CI/CD pipelines is crucial. We are seeing a lot of advancements in the platform engineering areas, providing self-serve systems, which means it must be working!</p>
<p>At Nexxen, We've implemented a robust system using custom-made GitLab CI/CD templates that allows developers to build and manage their own pipelines effortlessly. This self-serve system not only accelerates the development process but also ensures consistency and best practices across all projects.</p>
<p>In this blog post, I'll walk you through how we achieved this, including our self-documenting system that generates documentation for all CI/CD templates.</p>
<h2 id="the-power-of-gitlab-ci-cd-templates">The Power of GitLab CI/CD Templates<a class="zola-anchor" href="#the-power-of-gitlab-ci-cd-templates" aria-label="Anchor link for: the-power-of-gitlab-ci-cd-templates" style="visibility: hidden;"></a>
</h2>
<p>GitLab CI/CD templates are reusable steps that can be included in multiple projects. By creating a library of these templates, we provide developers with a set of predefined jobs and stages that they can easily include in their <code>.gitlab-ci.yml</code> files.</p>
<p>This approach ensures that all pipelines adhere to the company's standards and best practices, and allows the operation teams to roll out company-wide changes and improvements.</p>
<h2 id="the-inner-workings">The Inner Workings<a class="zola-anchor" href="#the-inner-workings" aria-label="Anchor link for: the-inner-workings" style="visibility: hidden;"></a>
</h2>
<p>We constructed a monorepo that consists of all our CI/CD templates, defined in respective YAML files, and a <code>root.yml</code> file that includes all our templates and defines common variables and stages, like so:</p>
<pre class="giallo z-code"><code data-lang="yaml"><span class="giallo-l"><span class="z-entity z-name z-tag">v</span><span class="z-entity z-name z-tag">ariables</span><span>:</span></span>
<span class="giallo-l"><span class="z-entity z-name z-tag">  I</span><span class="z-entity z-name z-tag">MAGE_TAG</span><span>:</span><span class="z-string"> $</span><span class="z-string">{CI_COMMIT_SHORT_SHA}</span></span>
<span class="giallo-l"><span class="z-entity z-name z-tag">  I</span><span class="z-entity z-name z-tag">MAGE_NAME</span><span>:</span><span class="z-string"> $</span><span class="z-string">{CI_PROJECT_NAME}:${IMAGE_TAG}</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-comment">  #</span><span class="z-comment"> -- snip --</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-entity z-name z-tag">s</span><span class="z-entity z-name z-tag">tages</span><span>:</span></span>
<span class="giallo-l"><span>  -</span><span class="z-string"> t</span><span class="z-string">est</span></span>
<span class="giallo-l"><span>  -</span><span class="z-string"> a</span><span class="z-string">nalyze</span></span>
<span class="giallo-l"><span>  -</span><span class="z-string"> b</span><span class="z-string">uild</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-comment">  #</span><span class="z-comment"> -- snip --</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-entity z-name z-tag">i</span><span class="z-entity z-name z-tag">nclude</span><span>:</span></span>
<span class="giallo-l"><span>  -</span><span class="z-punctuation z-definition z-string"> &#39;</span><span class="z-string">utilities/*.yml</span><span class="z-punctuation z-definition z-string">&#39;</span></span>
<span class="giallo-l"><span>  -</span><span class="z-punctuation z-definition z-string"> &#39;</span><span class="z-string">templates/**/*.yml</span><span class="z-punctuation z-definition z-string">&#39;</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-comment">  #</span><span class="z-comment"> -- snip --</span></span></code></pre>
<p>And an example of a step template:</p>
<pre class="giallo z-code"><code data-lang="yaml"><span class="giallo-l"><span class="z-punctuation z-definition z-comment">#</span><span class="z-comment"> Description: Send a Slack message</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-comment">#</span><span class="z-comment"> RequiredExtensions:</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-comment">#</span><span class="z-comment">   stage: The stage in which the step runs</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-comment">#</span><span class="z-comment"> RequiredVariables:</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-comment">#</span><span class="z-comment">   SLACK_WEBHOOK: Slack webhook URL</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-comment">#</span><span class="z-comment">   MESSAGE: Message content in markdown, with support for Gomplate templating</span></span>
<span class="giallo-l"><span class="z-entity z-name z-tag">.</span><span class="z-entity z-name z-tag">slack:send-message</span><span>:</span></span>
<span class="giallo-l"><span class="z-entity z-name z-tag">  i</span><span class="z-entity z-name z-tag">mage</span><span>:</span><span class="z-string"> o</span><span class="z-string">rganization/image</span></span>
<span class="giallo-l"><span class="z-entity z-name z-tag">  v</span><span class="z-entity z-name z-tag">ariables</span><span>:</span></span>
<span class="giallo-l"><span class="z-entity z-name z-tag">    S</span><span class="z-entity z-name z-tag">LACK_WEBHOOK</span><span>:</span><span class="z-punctuation z-definition z-string"> &#39;</span><span class="z-punctuation z-definition z-string">&#39;</span></span>
<span class="giallo-l"><span class="z-entity z-name z-tag">    M</span><span class="z-entity z-name z-tag">ESSAGE</span><span>:</span><span class="z-punctuation z-definition z-string"> &#39;</span><span class="z-punctuation z-definition z-string">&#39;</span></span>
<span class="giallo-l"><span class="z-entity z-name z-tag">  s</span><span class="z-entity z-name z-tag">cript</span><span>:</span></span>
<span class="giallo-l"><span>    -</span><span class="z-keyword"> |</span></span>
<span class="giallo-l"><span class="z-string">      cat &lt;&lt;&#39;EOF&#39; &gt; notification_template</span></span>
<span class="giallo-l"><span class="z-string">      {</span></span>
<span class="giallo-l"><span class="z-string">        &quot;text&quot;: &quot;{{ .MESSAGE }}&quot;</span></span>
<span class="giallo-l"><span class="z-string">      }</span></span>
<span class="giallo-l"><span class="z-string">      EOF</span></span>
<span class="giallo-l"><span>    -</span><span class="z-string"> r</span><span class="z-string">enderkit -f notification_template -ds env:// &gt; notification.json</span></span>
<span class="giallo-l"><span>    -</span><span class="z-punctuation z-definition z-string"> &#39;</span><span class="z-string">curl -X POST -H &quot;Content-type: application/json&quot; --data @notification.json ${SLACK_WEBHOOK}</span><span class="z-punctuation z-definition z-string">&#39;</span></span></code></pre>
<p><em>Shameless plug: We use <a rel="nofollow noreferrer external" href="https://github.com/orellazri/renderkit">Render Kit</a> to render templates, which is a handly tool that I developed, check it out!</em></p>
<h2 id="example-of-using-templates">Example of Using Templates<a class="zola-anchor" href="#example-of-using-templates" aria-label="Anchor link for: example-of-using-templates" style="visibility: hidden;"></a>
</h2>
<p>For developers to use our templates, all they have to do is create steps that extend the template, like so:</p>
<pre class="giallo z-code"><code data-lang="yaml"><span class="giallo-l"><span class="z-entity z-name z-tag">d</span><span class="z-entity z-name z-tag">ocker-build</span><span>:</span></span>
<span class="giallo-l"><span class="z-entity z-name z-tag">  e</span><span class="z-entity z-name z-tag">xtends</span><span>:</span><span class="z-string"> .</span><span class="z-string">docker:build</span></span></code></pre>
<p>Developers can also extend these templates to add additional steps or override existing values. For instance, if a developer wants to build a Maven-based project with a specific image of Maven and apply additional rules, they can extend the template and specify a custom Docker image:</p>
<pre class="giallo z-code"><code data-lang="yaml"><span class="giallo-l"><span class="z-entity z-name z-tag">m</span><span class="z-entity z-name z-tag">aven-build</span><span>:</span></span>
<span class="giallo-l"><span class="z-entity z-name z-tag">  e</span><span class="z-entity z-name z-tag">xtends</span><span>:</span><span class="z-string"> .</span><span class="z-string">maven:build</span></span>
<span class="giallo-l"><span class="z-entity z-name z-tag">  i</span><span class="z-entity z-name z-tag">mage</span><span>:</span><span class="z-string"> m</span><span class="z-string">aven:3.9.4-amazoncorretto-20</span></span>
<span class="giallo-l"><span class="z-entity z-name z-tag">  r</span><span class="z-entity z-name z-tag">ules</span><span>:</span></span>
<span class="giallo-l"><span>    -</span><span class="z-entity z-name z-tag"> i</span><span class="z-entity z-name z-tag">f</span><span>:</span><span class="z-string"> $</span><span class="z-string">CI_PIPELINE_SOURCE == &quot;merge_request_event&quot;</span></span>
<span class="giallo-l"><span class="z-entity z-name z-tag">      w</span><span class="z-entity z-name z-tag">hen</span><span>:</span><span class="z-string"> m</span><span class="z-string">anual</span></span></code></pre><h2 id="self-documenting-system">Self-Documenting System<a class="zola-anchor" href="#self-documenting-system" aria-label="Anchor link for: self-documenting-system" style="visibility: hidden;"></a>
</h2>
<p>To make it easier for developers to understand and use our templates, we built a self-documenting system. Each template is annotated with metadata in the form of commented YAML. This metadata is parsed and used to generate markdown documentation that describes each template.</p>
<p>Here's an example of a template with metadata annotations:</p>
<pre class="giallo z-code"><code data-lang="yaml"><span class="giallo-l"><span class="z-punctuation z-definition z-comment">#</span><span class="z-comment"> Description: Builds a Docker image</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-comment">#</span><span class="z-comment"> OptionalVariables:</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-comment">#</span><span class="z-comment">   DOCKERFILE_PATH: The path to the dockerfile (e.g. path/to/dockerfile)</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-comment">#</span><span class="z-comment">   EXTRA_ARGS: Extra arguments to pass to the build command (e.g. `--build-arg FOO=bar`)</span></span>
<span class="giallo-l"><span class="z-entity z-name z-tag">.</span><span class="z-entity z-name z-tag">docker:build</span><span>:</span></span></code></pre>
<p>We developed a tool in Go that reads the template directories, parses the metadata from the templates, and generates markdown files, which we then serve using MkDocs.</p>
<p>Each template can include documentation for optional and requires variables, stage definition, and more.
The resulting documentation shows how to use each template, with practical examples and explanations.</p>
<p>The output, when rendered by MkDocs, looks like this:
<img src="../self-serve-gitlab-ci-cd-templates-mkdocs-screenshot.png" alt="MkDocs Screenshot" title="Screenshot of MkDocs output" /></p>
<p>By implementing generic templates in GitLab, we have empowered our developers to build and manage their own CI/CD pipelines. This self-serve system not only accelerates the development process but also ensures consistency and best practices across all projects.</p>

      </article>

      
      

      
      
    </div>

    


<footer>
  <div class="left">
    <div class="copyright">
      
      
    </div>
  </div>

  <div class="right">
    
    
      
    
    
    <a id="rss-btn" href="https://orellazri.com/atom.xml">RSS</a>
    
    

    
  </div>
</footer>




<dialog id="rss-mask">
  <div>
    <a href="https:&#x2F;&#x2F;orellazri.com&#x2F;atom.xml">https:&#x2F;&#x2F;orellazri.com&#x2F;atom.xml</a>
    
    
    <button autofocus aria-label="copy" data-link="https:&#x2F;&#x2F;orellazri.com&#x2F;atom.xml" data-copy-icon="&lt;svg xmlns=&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2000&#x2F;svg&quot; viewBox=&quot;0 0 24 24&quot; width=&quot;18&quot; height=&quot;18&quot;&gt;&lt;path d=&quot;M6.9998 6V3C6.9998 2.44772 7.44752 2 7.9998 2H19.9998C20.5521 2 20.9998 2.44772 20.9998 3V17C20.9998 17.5523 20.5521 18 19.9998 18H16.9998V20.9991C16.9998 21.5519 16.5499 22 15.993 22H4.00666C3.45059 22 3 21.5554 3 20.9991L3.0026 7.00087C3.0027 6.44811 3.45264 6 4.00942 6H6.9998ZM5.00242 8L5.00019 20H14.9998V8H5.00242ZM8.9998 6H16.9998V16H18.9998V4H8.9998V6Z&quot; fill=&quot;currentColor&quot;&gt;&lt;&#x2F;path&gt;&lt;&#x2F;svg&gt;
" data-check-icon="&lt;svg xmlns=&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2000&#x2F;svg&quot; viewBox=&quot;0 0 24 24&quot; width=&quot;18&quot; height=&quot;18&quot;&gt;&lt;path d=&quot;M10.0007 15.1709L19.1931 5.97852L20.6073 7.39273L10.0007 17.9993L3.63672 11.6354L5.05093 10.2212L10.0007 15.1709Z&quot; fill=&quot;currentColor&quot;&gt;&lt;&#x2F;path&gt;&lt;&#x2F;svg&gt;
" >
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18"><path d="M6.9998 6V3C6.9998 2.44772 7.44752 2 7.9998 2H19.9998C20.5521 2 20.9998 2.44772 20.9998 3V17C20.9998 17.5523 20.5521 18 19.9998 18H16.9998V20.9991C16.9998 21.5519 16.5499 22 15.993 22H4.00666C3.45059 22 3 21.5554 3 20.9991L3.0026 7.00087C3.0027 6.44811 3.45264 6 4.00942 6H6.9998ZM5.00242 8L5.00019 20H14.9998V8H5.00242ZM8.9998 6H16.9998V16H18.9998V4H8.9998V6Z" fill="currentColor"></path></svg>

    </button>
  </div>
</dialog>



  </main>
</div>

  
<script src="/js/lightense.min.js"></script>


  <script src="https://orellazri.com/js/main.js"></script>
</body>

</html>
