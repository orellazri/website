<!DOCTYPE html>
<html lang="en" class="dark light">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="base" content="https:&#x2F;&#x2F;orellazri.com">

    

    
    
    
    <title>
         Empowering Developers with Self-Serve GitLab CI&#x2F;CD Templates
        
    </title>

        
            <meta property="og:title" content="Empowering Developers with Self-Serve GitLab CI&#x2F;CD Templates" />
        
     

     
         
     

     
         
    

    
    
        <link rel="icon" type="image/png" href=&#x2F;favicon.svg />
    

    
    
        <link href=https://orellazri.com/fonts.css rel="stylesheet" />
    

    
    
        

        
            
            

            <script data-goatcounter="https://orellazri.goatcounter.com/count" async src="https://orellazri.com/js/count.js"></script>
            <noscript>
                
                <img src="https://orellazri.goatcounter.com//count?p=&#x2F;posts&#x2F;self-serve-gitlab-ci-cd-templates&#x2F;&t=Empowering Developers with Self-Serve GitLab CI&#x2F;CD Templates">
            </noscript>
        
    

    
    

    
    
        <script src=https://orellazri.com/js/toc.js></script>
    

    
    

    

    
    <link rel="alternate" type="application/atom+xml" title="Orel Lazri" href="https://orellazri.com/atom.xml">


    
    
        <link rel="stylesheet" type="text/css" href=https://orellazri.com/theme/light.css />
        <link rel="stylesheet" type="text/css" href="https://orellazri.com/theme/dark.css" media="(prefers-color-scheme: dark)" />
    

    <!-- Set the correct theme in the script -->
    <script src=https://orellazri.com/js/themetoggle.js></script>
    
        <script>
            if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
                setTheme("dark");
            } else {
                setTheme("light");
            }
        </script>
    

    <link rel="stylesheet" type="text/css" media="screen" href=https://orellazri.com/main.css />

    

    <script src=https://orellazri.com/js/mermaid.js></script>

    <script defer src="https://orellazri.com/search_index.en.js?h=3a69812dc9773e8d3635"></script>
        <script defer src="https://orellazri.com/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e"></script></head>


<body>
    <div class="content">
        <header>
    <div class="main">
        
            <a href=https:&#x2F;&#x2F;orellazri.com>Orel Lazri</a>
        


        <div class="socials">
            
            <a rel="me" href="https:&#x2F;&#x2F;github.com&#x2F;orellazri" class="social">
                <img alt=github src=https://orellazri.com/social_icons/github.svg>
            </a>
            
            <a rel="me" href="https:&#x2F;&#x2F;linkedin.com&#x2F;in&#x2F;orellazri" class="social">
                <img alt=linkedin src=https://orellazri.com/social_icons/linkedin.svg>
            </a>
            
        </div>
    </div>

    <nav>
        
            <a href=https://orellazri.com/posts style="margin-left: 0.25em">posts</a>
        
            <a href=https://orellazri.com/projects style="margin-left: 0.25em">projects</a>
        
            <a href=https://orellazri.com/atom.xml style="margin-left: 0.25em">rss</a>
        

        
        <button 
            id="search-button"
            class="search-button"
            title="$SHORTCUT to open search"
        >
            <img 
                src="https://orellazri.com/search.svg" 
                alt="Search" 
                class="search-icon"
            >
        </button>

        <div id="searchModal" class="search-modal js" role="dialog" aria-labelledby="modalTitle">
            <div id="modal-content">
                <h1 id="modalTitle" class="page-header">Search</h1>
                <div id="searchBar">
                    <input 
                        id="searchInput" 
                        role="combobox" 
                        autocomplete="off" 
                        spellcheck="false" 
                        aria-expanded="false" 
                        aria-controls="results-container" 
                        placeholder="Search..."
                    />
                    <button 
                        id="clear-search" 
                        class="clear-button"
                        title="Clear search"
                    >
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960">
                            <path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/>
                        </svg>
                    </button>
                </div>
                <div id="results-container">
                    <div id="results-info">
                        <span id="zero_results" style="display: none;">No results</span>
                        <span id="one_result" style="display: none;">1 result</span>
                        <span id="many_results" style="display: none;">$NUMBER results</span>
                    </div>
                    <div id="results" role="listbox"></div>
                </div>
            </div>
        </div>
        

        
    </nav>
</header>


        
        
    
<main>
    <article>
        <div class="title">
            
            
    <div class="page-header">
        Empowering Developers with Self-Serve GitLab CI&#x2F;CD Templates<span class="primary-color" style="font-size: 1.6em">.</span>
    </div>


                <div class="meta">
                    
                        Posted on <time>2024-11-23</time>
                    

                    

                    

                    
                    
                            <span class="tags-label"> :: Tags:</span>
                            <span class="tags">
                                    <a href="https://orellazri.com/tags/devops/" class="post-tag">devops</a>
                                
                            </span>
                    

                    
                    

                    

                </div>
        </div>

        

        
        
        
            <div class="toc-container">
                <h1 class="toc-title">Table of Contents</h1>
                <ul class="toc-list">
                    
                        <li>
                            <a href="https://orellazri.com/posts/self-serve-gitlab-ci-cd-templates/#the-power-of-gitlab-ci-cd-templates">The Power of GitLab CI&#x2F;CD Templates</a>
                            
                        </li>
                    
                        <li>
                            <a href="https://orellazri.com/posts/self-serve-gitlab-ci-cd-templates/#the-inner-workings">The Inner Workings</a>
                            
                        </li>
                    
                        <li>
                            <a href="https://orellazri.com/posts/self-serve-gitlab-ci-cd-templates/#example-of-using-templates">Example of Using Templates</a>
                            
                        </li>
                    
                        <li>
                            <a href="https://orellazri.com/posts/self-serve-gitlab-ci-cd-templates/#self-documenting-system">Self-Documenting System</a>
                            
                        </li>
                    
                </ul>
            </div>
        
        

        <section class="body">
            <p>Empowering developers to manage their own CI/CD pipelines is crucial. We are seeing a lot of advancements in the platform engineering areas, providing self-serve systems, which means it must be working!</p>
<p>At Nexxen, We've implemented a robust system using custom-made GitLab CI/CD templates that allows developers to build and manage their own pipelines effortlessly. This self-serve system not only accelerates the development process but also ensures consistency and best practices across all projects.</p>
<p>In this blog post, I'll walk you through how we achieved this, including our self-documenting system that generates documentation for all CI/CD templates.</p>
<h2 id="the-power-of-gitlab-ci-cd-templates"><a class="zola-anchor" href="#the-power-of-gitlab-ci-cd-templates" aria-label="Anchor link for: the-power-of-gitlab-ci-cd-templates">The Power of GitLab CI/CD Templates</a></h2>
<p>GitLab CI/CD templates are reusable steps that can be included in multiple projects. By creating a library of these templates, we provide developers with a set of predefined jobs and stages that they can easily include in their <code>.gitlab-ci.yml</code> files.</p>
<p>This approach ensures that all pipelines adhere to the company's standards and best practices, and allows the operation teams to roll out company-wide changes and improvements.</p>
<h2 id="the-inner-workings"><a class="zola-anchor" href="#the-inner-workings" aria-label="Anchor link for: the-inner-workings">The Inner Workings</a></h2>
<p>We constructed a monorepo that consists of all our CI/CD templates, defined in respective YAML files, and a <code>root.yml</code> file that includes all our templates and defines common variables and stages, like so:</p>
<pre data-lang="yaml" style="background-color:#2b303b;color:#c0c5ce;" class="language-yaml "><code class="language-yaml" data-lang="yaml"><span style="color:#bf616a;">variables</span><span>:
</span><span>  </span><span style="color:#bf616a;">IMAGE_TAG</span><span>: </span><span style="color:#a3be8c;">${CI_COMMIT_SHORT_SHA}
</span><span>  </span><span style="color:#bf616a;">IMAGE_NAME</span><span>: </span><span style="color:#a3be8c;">${CI_PROJECT_NAME}:${IMAGE_TAG}
</span><span>  </span><span style="color:#65737e;"># -- snip --
</span><span>
</span><span style="color:#bf616a;">stages</span><span>:
</span><span>  - </span><span style="color:#a3be8c;">test
</span><span>  - </span><span style="color:#a3be8c;">analyze
</span><span>  - </span><span style="color:#a3be8c;">build
</span><span>  </span><span style="color:#65737e;"># -- snip --
</span><span>
</span><span style="color:#bf616a;">include</span><span>:
</span><span>  - &#39;</span><span style="color:#a3be8c;">utilities/*.yml</span><span>&#39;
</span><span>  - &#39;</span><span style="color:#a3be8c;">templates/**/*.yml</span><span>&#39;
</span><span>  </span><span style="color:#65737e;"># -- snip --
</span></code></pre>
<p>And an example of a step template:</p>
<pre data-lang="yaml" style="background-color:#2b303b;color:#c0c5ce;" class="language-yaml "><code class="language-yaml" data-lang="yaml"><span style="color:#65737e;"># Description: Send a Slack message
</span><span style="color:#65737e;"># RequiredExtensions:
</span><span style="color:#65737e;">#   stage: The stage in which the step runs
</span><span style="color:#65737e;"># RequiredVariables:
</span><span style="color:#65737e;">#   SLACK_WEBHOOK: Slack webhook URL
</span><span style="color:#65737e;">#   MESSAGE: Message content in markdown, with support for Gomplate templating
</span><span style="color:#bf616a;">.slack:send-message</span><span>:
</span><span>  </span><span style="color:#bf616a;">image</span><span>: </span><span style="color:#a3be8c;">organization/image
</span><span>  </span><span style="color:#bf616a;">variables</span><span>:
</span><span>    </span><span style="color:#bf616a;">SLACK_WEBHOOK</span><span>: &#39;&#39;
</span><span>    </span><span style="color:#bf616a;">MESSAGE</span><span>: &#39;&#39;
</span><span>  </span><span style="color:#bf616a;">script</span><span>:
</span><span>    - </span><span style="color:#b48ead;">|
</span><span style="color:#a3be8c;">      cat &lt;&lt;&#39;EOF&#39; &gt; notification_template
</span><span style="color:#a3be8c;">      {
</span><span style="color:#a3be8c;">        &quot;text&quot;: &quot;{{ .MESSAGE }}&quot;
</span><span style="color:#a3be8c;">      }
</span><span style="color:#a3be8c;">      EOF
</span><span>    - </span><span style="color:#a3be8c;">renderkit -f notification_template -ds env:// &gt; notification.json
</span><span>    - &#39;</span><span style="color:#a3be8c;">curl -X POST -H &quot;Content-type: application/json&quot; --data @notification.json ${SLACK_WEBHOOK}</span><span>&#39;
</span></code></pre>
<p><em>Shameless plug: We use <a href="https://github.com/orellazri/renderkit">Render Kit</a> to render templates, which is a handly tool that I developed, check it out!</em></p>
<h2 id="example-of-using-templates"><a class="zola-anchor" href="#example-of-using-templates" aria-label="Anchor link for: example-of-using-templates">Example of Using Templates</a></h2>
<p>For developers to use our templates, all they have to do is create steps that extend the template, like so:</p>
<pre data-lang="yaml" style="background-color:#2b303b;color:#c0c5ce;" class="language-yaml "><code class="language-yaml" data-lang="yaml"><span style="color:#bf616a;">docker-build</span><span>:
</span><span>  </span><span style="color:#bf616a;">extends</span><span>: </span><span style="color:#a3be8c;">.docker:build
</span></code></pre>
<p>Developers can also extend these templates to add additional steps or override existing values. For instance, if a developer wants to build a Maven-based project with a specific image of Maven and apply additional rules, they can extend the template and specify a custom Docker image:</p>
<pre data-lang="yaml" style="background-color:#2b303b;color:#c0c5ce;" class="language-yaml "><code class="language-yaml" data-lang="yaml"><span style="color:#bf616a;">maven-build</span><span>:
</span><span>  </span><span style="color:#bf616a;">extends</span><span>: </span><span style="color:#a3be8c;">.maven:build
</span><span>  </span><span style="color:#bf616a;">image</span><span>: </span><span style="color:#a3be8c;">maven:3.9.4-amazoncorretto-20
</span><span>  </span><span style="color:#bf616a;">rules</span><span>:
</span><span>    - </span><span style="color:#bf616a;">if</span><span>: </span><span style="color:#a3be8c;">$CI_PIPELINE_SOURCE == &quot;merge_request_event&quot;
</span><span>      </span><span style="color:#bf616a;">when</span><span>: </span><span style="color:#a3be8c;">manual
</span></code></pre>
<h2 id="self-documenting-system"><a class="zola-anchor" href="#self-documenting-system" aria-label="Anchor link for: self-documenting-system">Self-Documenting System</a></h2>
<p>To make it easier for developers to understand and use our templates, we built a self-documenting system. Each template is annotated with metadata in the form of commented YAML. This metadata is parsed and used to generate markdown documentation that describes each template.</p>
<p>Here's an example of a template with metadata annotations:</p>
<pre data-lang="yaml" style="background-color:#2b303b;color:#c0c5ce;" class="language-yaml "><code class="language-yaml" data-lang="yaml"><span style="color:#65737e;"># Description: Builds a Docker image
</span><span style="color:#65737e;"># OptionalVariables:
</span><span style="color:#65737e;">#   DOCKERFILE_PATH: The path to the dockerfile (e.g. path/to/dockerfile)
</span><span style="color:#65737e;">#   EXTRA_ARGS: Extra arguments to pass to the build command (e.g. `--build-arg FOO=bar`)
</span><span style="color:#bf616a;">.docker:build</span><span>:
</span></code></pre>
<p>We developed a tool in Go that reads the template directories, parses the metadata from the templates, and generates markdown files, which we then serve using MkDocs.</p>
<p>Each template can include documentation for optional and requires variables, stage definition, and more.
The resulting documentation shows how to use each template, with practical examples and explanations.</p>
<p>The output, when rendered by MkDocs, looks like this:
<img src="../self-serve-gitlab-ci-cd-templates-mkdocs-screenshot.png" alt="MkDocs Screenshot" title="Screenshot of MkDocs output" /></p>
<p>By implementing generic templates in GitLab, we have empowered our developers to build and manage their own CI/CD pipelines. This self-serve system not only accelerates the development process but also ensures consistency and best practices across all projects.</p>

        </section>
    </article>
</main>



        
            
        

        
    </div>
</body>

</html>
