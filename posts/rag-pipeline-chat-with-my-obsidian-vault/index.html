<!DOCTYPE html>

<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="color-scheme" content="light dark">
  
  
    
  
  <meta name="description" content="">

  <title>RAG Pipeline to Chat with My Obsidian Vault</title>
  <link rel="icon" type="image/png" sizes="32x32" href="https://orellazri.com/img/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://orellazri.com/img/favicon-16x16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="https://orellazri.com/img/apple-touch-icon.png">
  <style>
@font-face {
  font-display: swap;
  font-family: 'Piazzolla';
  font-style: normal;
  font-weight: 400;
  src: url('/font/Piazzolla.woff2') format('woff2');
}
</style>

  <style>

  /* light mode colors */
  body {
    --primary-color: #5871a2;
    --primary-pale-color: #5871a233;
    --primary-decoration-color: #5871a210;
    --bg-color: #ffffff;
    --text-color: #2f3030;
    --text-pale-color: #767676;
    --text-decoration-color: #a9a9a9;
    --highlight-mark-color: #5f75b020;

    --callout-note-color: #5871a2;
    --callout-tip-color: #268556;
    --callout-important-color: #885fc9;
    --callout-warning-color: #ab6632;
    --callout-caution-color: #c64e4e;
  }

  /* dark mode colors */
  body.dark {
    --primary-color: #6f8fd1;
    --primary-pale-color: #6f8fd166;
    --primary-decoration-color: #6f8fd112;
    --bg-color: #2b2b38;
    --text-color: #c1c1c1;
    --text-pale-color: #848484;
    --text-decoration-color: #5f5f5f;
    --highlight-mark-color: #8296cb3b;

    --callout-note-color: #6f8fd1;
    --callout-tip-color: #47976f;
    --callout-important-color: #9776cd;
    --callout-warning-color: #ad7a52;
    --callout-caution-color: #d06161;
  }

  /* typography */
  body {
    --main-font: 'Piazzolla', serif;
    --code-font: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;
    --homepage-max-width: 768px;
    --main-max-width: 768px;
    --avatar-size: 50px;
    --font-size: 17px;
    --line-height: 1.75;
    --img-border-radius: 0px;
    --detail-border-radius: 0px;
    --dark-mode-img-brightness: 0.75;
    --dark-mode-chart-brightness: 0.75;
    --inline-code-border-radius: 2px;
    --inline-code-bg-color: var(--primary-decoration-color);
    --block-code-border-radius: 0px;
    --block-code-border-color: var(--primary-color);
    --detail-border-color: var(--primary-color);
  }

</style>

  <link rel="stylesheet" href="https://orellazri.com/main.css">
  

<link id="hl" rel="stylesheet" type="text/css" href="/giallo-dark.css" />



  <script data-goatcounter="https://orellazri.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>

</head>

<body class="post dark">
  
  
<div id="wrapper">
  <div id="blank"></div>
  <aside>
    
    
    <nav>
      <ul>
        
        <li>
          <a class="h2" href="#a-local-rag-pipeline">A Local RAG Pipeline</a>
          
        </li>
        
        <li>
          <a class="h2" href="#the-implementation">The Implementation</a>
          
          <ul>
            
            <li>
              <a class="h3" href="#first-step-markdown-parsing-and-chunking">First step: Markdown Parsing and Chunking</a>
            </li>
            
            <li>
              <a class="h3" href="#second-step-vector-embeddings-with-sqlite">Second step: Vector Embeddings with SQLite</a>
            </li>
            
            <li>
              <a class="h3" href="#third-step-querying-the-vector-database">Third step: Querying the vector database</a>
            </li>
            
          </ul>
          
        </li>
        
        <li>
          <a class="h2" href="#usage">Usage</a>
          
        </li>
        
        <li>
          <a class="h2" href="#local-first-approach">Local-First Approach</a>
          
        </li>
        
      </ul>
    </nav>
    
    
    <button id="back-to-top" aria-label="back to top">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-up"><line x1="12" y1="19" x2="12" y2="5"></line><polyline points="5 12 12 5 19 12"></polyline></svg>

    </button>
    
  </aside>
  <main>
    
<header>
  <nav>
    <a id="back-link" href="https:&#x2F;&#x2F;orellazri.com&#x2F;posts">‚Üê Back</a>
  </nav>
</header>


    <div>
      
      
      
      
      <div id="copy-cfg" style="display: none;" data-copy-icon="&lt;svg xmlns=&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2000&#x2F;svg&quot; viewBox=&quot;0 0 24 24&quot; width=&quot;18&quot; height=&quot;18&quot;&gt;&lt;path d=&quot;M6.9998 6V3C6.9998 2.44772 7.44752 2 7.9998 2H19.9998C20.5521 2 20.9998 2.44772 20.9998 3V17C20.9998 17.5523 20.5521 18 19.9998 18H16.9998V20.9991C16.9998 21.5519 16.5499 22 15.993 22H4.00666C3.45059 22 3 21.5554 3 20.9991L3.0026 7.00087C3.0027 6.44811 3.45264 6 4.00942 6H6.9998ZM5.00242 8L5.00019 20H14.9998V8H5.00242ZM8.9998 6H16.9998V16H18.9998V4H8.9998V6Z&quot; fill=&quot;currentColor&quot;&gt;&lt;&#x2F;path&gt;&lt;&#x2F;svg&gt;
" data-check-icon="&lt;svg xmlns=&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2000&#x2F;svg&quot; viewBox=&quot;0 0 24 24&quot; width=&quot;18&quot; height=&quot;18&quot;&gt;&lt;path d=&quot;M10.0007 15.1709L19.1931 5.97852L20.6073 7.39273L10.0007 17.9993L3.63672 11.6354L5.05093 10.2212L10.0007 15.1709Z&quot; fill=&quot;currentColor&quot;&gt;&lt;&#x2F;path&gt;&lt;&#x2F;svg&gt;
"></div>
      
      <article class="prose">
        <h1>RAG Pipeline to Chat with My Obsidian Vault</h1>
        <div id="post-info">
          <div id="date">
            <span id="publish">Jun 21, 2025</span>
            </div>

          
          <div id="tags">
            <a class="instant" href="https://orellazri.com/tags/coding"><span>#</span>coding</a><a class="instant" href="https://orellazri.com/tags/ai"><span>#</span>ai</a>
          </div>
          
        </div>

        
        

        

        <p>My Obsidian vault has grown significantly over time with snippets, project documentation, meeting notes, and random thoughts. I wanted a conversational way to interact with my notes - to ask natural language questions like "How did I fix that Git submodule issue?" or "What were the main challenges in the refactor?" and get contextual answers from my notes.</p>
<p>Rather than relying on cloud-based solutions, I decided to see if I could build my own RAG (Retrieval Augmented Generation) pipeline that runs entirely locally, keeping my notes private and giving me full control over the implementation - mainly for fun.</p>
<p>You can find the source code <a rel="nofollow noreferrer external" href="https://github.com/orellazri/mdrag">here</a>.</p>
<h2 id="a-local-rag-pipeline">A Local RAG Pipeline<a class="zola-anchor" href="#a-local-rag-pipeline" aria-label="Anchor link for: a-local-rag-pipeline" style="visibility: hidden;"></a>
</h2>
<p>I built <strong>mdrag</strong> (Markdown RAG), a Rust-based CLI tool that creates a searchable vector database from markdown files and uses local AI models to generate responses. The name might not be the most creative, but it gets the job done!</p>
<p>The system works in two phases:</p>
<ol>
<li><strong>Embedding</strong>: Process all markdown files, chunk them intelligently, and generate vector embeddings</li>
<li><strong>Querying</strong>: Take natural language queries, find similar content, and use a local LLM to generate answers</li>
</ol>
<h2 id="the-implementation">The Implementation<a class="zola-anchor" href="#the-implementation" aria-label="Anchor link for: the-implementation" style="visibility: hidden;"></a>
</h2>
<p>These are the main interesting dependencies I've used:</p>
<ul>
<li><a rel="nofollow noreferrer external" href="https://docs.rs/rusqlite/latest/rusqlite/">rusqlite</a> and <a rel="nofollow noreferrer external" href="https://docs.rs/sqlite-vec/latest/sqlite_vec/">sqlite-vec</a> for using SQLite as a vector database</li>
<li><a rel="nofollow noreferrer external" href="https://docs.rs/ollama-rs/latest/ollama_rs/">ollama-rs</a> - This allows me to interact with a local Ollama instance in an idiomatic way instead of writing and parsing plain requests</li>
<li><a rel="nofollow noreferrer external" href="https://docs.rs/zerocopy/latest/zerocopy/">zerocopy</a> - For zero-cost memory manipulation. This is used to reference data in and out of SQLite without memory allocations.</li>
</ul>
<h3 id="first-step-markdown-parsing-and-chunking">First step: Markdown Parsing and Chunking<a class="zola-anchor" href="#first-step-markdown-parsing-and-chunking" aria-label="Anchor link for: first-step-markdown-parsing-and-chunking" style="visibility: hidden;"></a>
</h3>
<p>One of the trickiest parts was intelligently chunking markdown content. Simply splitting by character count would break apart related information. Instead, I implemented a parser that is slightly more sophisticated, though it could still be improved significantly:</p>
<ol>
<li><strong>Detects the primary header level</strong> used in each document</li>
<li><strong>Splits content by those headers</strong>, keeping related information together</li>
<li><strong>Handles edge cases</strong> like content before the first header</li>
<li><strong>Further splits large chunks</strong> while respecting paragraph boundaries</li>
</ol>
<pre class="giallo z-code"><code data-lang="rust"><span class="giallo-l"><span class="z-keyword">pub</span><span class="z-keyword"> fn</span><span class="z-entity z-name"> parse</span><span>(</span><span class="z-variable z-other">contents</span><span class="z-keyword">:</span><span class="z-keyword"> &amp;</span><span class="z-entity z-name">str</span><span>,</span><span class="z-variable z-other"> filename</span><span class="z-keyword">:</span><span class="z-keyword"> &amp;</span><span class="z-entity z-name">str</span><span>)</span><span class="z-keyword"> -&gt;</span><span class="z-entity z-name"> Result</span><span>&lt;</span><span class="z-entity z-name">Vec</span><span>&lt;</span><span class="z-entity z-name">String</span><span>&gt;</span><span>&gt;</span><span> {</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-comment">    //</span><span class="z-comment"> Find the first header type used in the document</span></span>
<span class="giallo-l"><span class="z-storage z-type">    let</span><span class="z-variable z-other"> header_regex</span><span class="z-keyword"> =</span><span class="z-entity z-name"> Regex</span><span class="z-keyword">::</span><span class="z-entity z-name">new</span><span>(</span><span class="z-string">r</span><span class="z-punctuation z-definition z-string">&quot;</span><span class="z-string">^(#{1,6})\s</span><span class="z-punctuation z-definition z-string">&quot;</span><span>)</span><span class="z-keyword">?</span><span>;</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-storage z-type">    let</span><span class="z-variable z-other"> first_header_level</span><span class="z-keyword"> =</span><span class="z-variable z-other"> contents</span></span>
<span class="giallo-l"><span class="z-keyword">        .</span><span class="z-entity z-name">lines</span><span>(</span><span>)</span></span>
<span class="giallo-l"><span class="z-keyword">        .</span><span class="z-entity z-name">find_map</span><span>(</span><span class="z-keyword">|</span><span class="z-variable z-other">line</span><span class="z-keyword">|</span><span class="z-variable z-other"> header_regex</span><span class="z-keyword">.</span><span class="z-entity z-name">captures</span><span>(</span><span class="z-variable z-other">line</span><span>)</span><span class="z-keyword">.</span><span class="z-entity z-name">map</span><span>(</span><span class="z-keyword">|</span><span class="z-variable z-other">caps</span><span class="z-keyword">|</span><span class="z-variable z-other"> caps</span><span>[</span><span class="z-constant">1</span><span>]</span><span class="z-keyword">.</span><span class="z-entity z-name">to_string</span><span>(</span><span>)</span><span>)</span><span>)</span><span>;</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-comment">    //</span><span class="z-comment"> Split by the detected header level or treat as single chunk</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-comment">    //</span><span class="z-comment"> Each chunk gets prefixed with the filename for context</span></span>
<span class="giallo-l"><span>}</span></span></code></pre>
<p>This approach ensures that a section like "## Git Snippets" stays together with all its related commands, making retrieval more meaningful.</p>
<h3 id="second-step-vector-embeddings-with-sqlite">Second step: Vector Embeddings with SQLite<a class="zola-anchor" href="#second-step-vector-embeddings-with-sqlite" aria-label="Anchor link for: second-step-vector-embeddings-with-sqlite" style="visibility: hidden;"></a>
</h3>
<p>Instead of using a dedicated vector database, I leveraged <strong>sqlite-vec</strong>, a SQLite extension that adds vector similarity search capabilities. This keeps the entire system self-contained-no additional services to run or manage.</p>
<p>This extension can be loaded with a short unsafe block:</p>
<pre class="giallo z-code"><code data-lang="rust"><span class="giallo-l"><span class="z-keyword">unsafe</span><span> {</span></span>
<span class="giallo-l"><span class="z-entity z-name">    sqlite3_auto_extension</span><span>(</span><span class="z-entity z-name">Some</span><span>(</span><span class="z-entity z-name">std</span><span class="z-keyword">::</span><span class="z-entity z-name">mem</span><span class="z-keyword">::</span><span class="z-entity z-name">transmute</span><span>(</span><span class="z-variable z-other">sqlite3_vec_init</span><span class="z-keyword"> as</span><span class="z-keyword"> *</span><span class="z-storage">const</span><span> (</span><span>)</span><span>)</span><span>)</span><span>)</span><span>;</span></span>
<span class="giallo-l"><span>}</span></span></code></pre>
<p>And then we can create a table with the following schema:</p>
<pre class="giallo z-code"><code data-lang="rust"><span class="giallo-l"><span class="z-keyword">pub</span><span class="z-keyword"> fn</span><span class="z-entity z-name"> new</span><span>(</span><span class="z-variable z-other">conn</span><span class="z-keyword">:</span><span class="z-keyword"> &amp;</span><span>&#39;</span><span class="z-entity z-name">a</span><span class="z-entity z-name"> Connection</span><span>,</span><span class="z-variable z-other"> ollama</span><span class="z-keyword">:</span><span class="z-keyword"> &amp;</span><span>&#39;</span><span class="z-entity z-name">a</span><span class="z-entity z-name"> Ollama</span><span>)</span><span class="z-keyword"> -&gt;</span><span class="z-entity z-name"> Result</span><span>&lt;</span><span class="z-variable z-language">Self</span><span>&gt;</span><span> {</span></span>
<span class="giallo-l"><span class="z-variable z-other">    conn</span><span class="z-keyword">.</span><span class="z-entity z-name">execute</span><span>(</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string">        &quot;</span><span class="z-string">CREATE VIRTUAL TABLE IF NOT EXISTS file_embeddings USING vec0(</span></span>
<span class="giallo-l"><span class="z-string">            path TEXT,</span></span>
<span class="giallo-l"><span class="z-string">            contents TEXT,</span></span>
<span class="giallo-l"><span class="z-string">            embedding FLOAT[768]</span></span>
<span class="giallo-l"><span class="z-string">        )</span><span class="z-punctuation z-definition z-string">&quot;</span><span>,</span></span>
<span class="giallo-l"><span>        [</span><span>]</span><span>,</span></span>
<span class="giallo-l"><span>    )</span><span class="z-keyword">?</span><span>;</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-entity z-name">    Ok</span><span>(</span><span class="z-variable z-language">Self</span><span> {</span><span class="z-variable z-other"> conn</span><span>,</span><span class="z-variable z-other"> ollama</span><span> }</span><span>)</span></span>
<span class="giallo-l"><span>}</span></span></code></pre>
<p>The embedding process walks through all markdown files in the vault, checks if they've already been processed (to avoid redundant work), and generates 768-dimensional vectors using Ollama's <a rel="nofollow noreferrer external" href="https://huggingface.co/nomic-ai/nomic-embed-text-v1.5">nomic-embed-text-v1.5</a> model. Using a different model means that the embedding vector size will probably need to be changed.</p>
<h3 id="third-step-querying-the-vector-database">Third step: Querying the vector database<a class="zola-anchor" href="#third-step-querying-the-vector-database" aria-label="Anchor link for: third-step-querying-the-vector-database" style="visibility: hidden;"></a>
</h3>
<p>In querying mode, a user enters a natural language query, and the system generates an embedding for it, then uses the vector database to find the most similar chunks. Finally, it uses the LLM to generate a response.</p>
<p>The interesting part where we fetch the similar vectors from SQLite is this:</p>
<pre class="giallo z-code"><code data-lang="rust"><span class="giallo-l"><span class="z-storage z-type">let</span><span class="z-storage"> mut</span><span class="z-variable z-other"> stmt</span><span class="z-keyword"> =</span><span class="z-variable z-language"> self</span><span class="z-keyword">.</span><span>conn</span><span class="z-keyword">.</span><span class="z-entity z-name">prepare</span><span>(</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string">    &quot;</span><span class="z-string">SELECT contents</span></span>
<span class="giallo-l"><span class="z-string">    FROM file_embeddings</span></span>
<span class="giallo-l"><span class="z-string">    WHERE embedding MATCH ?1</span></span>
<span class="giallo-l"><span class="z-string">    AND k = ?2</span></span>
<span class="giallo-l"><span class="z-string">    ORDER BY distance</span><span class="z-punctuation z-definition z-string">&quot;</span><span>,</span></span>
<span class="giallo-l"><span>)</span><span class="z-keyword">?</span><span>;</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-storage z-type">let</span><span class="z-variable z-other"> results</span><span class="z-keyword"> =</span><span class="z-variable z-other"> stmt</span></span>
<span class="giallo-l"><span class="z-keyword">    .</span><span class="z-entity z-name">query_map</span><span>(</span><span>(</span><span class="z-variable z-other">query_embedding</span><span>[</span><span class="z-constant">0</span><span>]</span><span class="z-keyword">.</span><span class="z-entity z-name">as_bytes</span><span>(</span><span>)</span><span>,</span><span class="z-variable z-other"> k</span><span class="z-keyword"> as</span><span class="z-entity z-name"> i32</span><span>)</span><span>,</span><span class="z-keyword"> |</span><span class="z-variable z-other">row</span><span class="z-keyword">|</span><span> {</span></span>
<span class="giallo-l"><span class="z-entity z-name">        Ok</span><span>(</span><span class="z-variable z-other">row</span><span class="z-keyword">.</span><span class="z-entity z-name">get</span><span>(</span><span class="z-constant">0</span><span>)</span><span class="z-keyword">?</span><span>)</span></span>
<span class="giallo-l"><span>    }</span><span>)</span><span class="z-keyword">?</span></span>
<span class="giallo-l"><span class="z-keyword">    .</span><span class="z-entity z-name">collect</span><span class="z-keyword">::</span><span>&lt;</span><span class="z-entity z-name">Result</span><span>&lt;</span><span class="z-entity z-name">Vec</span><span>&lt;</span><span class="z-entity z-name">String</span><span>&gt;</span><span>,</span><span class="z-variable z-other"> _</span><span>&gt;</span><span>&gt;</span><span>(</span><span>)</span><span class="z-keyword">?</span><span>;</span></span></code></pre>
<p>I used the <code>embedding MATCH</code> clause to find the most similar vectors to the query embedding, and return the contents (the original text that was embedded). This then lets the LLM generate a response based on the context of the most similar chunks.</p>
<p>For the actual text generation, I integrated with <strong>Ollama</strong>, which provides a simple API for running various models locally. I chose <code>gemma3:1b</code> because I wanted an extremely lightweight model to test things quickly.</p>
<pre class="giallo z-code"><code data-lang="rust"><span class="giallo-l"><span class="z-punctuation z-definition z-comment">//</span><span class="z-comment"> Embed the query</span></span>
<span class="giallo-l"><span class="z-storage z-type">let</span><span class="z-variable z-other"> results</span><span class="z-keyword"> =</span><span class="z-variable z-other"> embedder</span><span class="z-keyword">.</span><span class="z-entity z-name">search</span><span>(</span><span class="z-keyword">&amp;</span><span class="z-variable z-other">query</span><span>,</span><span class="z-constant"> 5</span><span>)</span><span class="z-keyword">.</span><span class="z-keyword">await</span><span class="z-keyword">?</span><span>;</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-comment">//</span><span class="z-comment"> Build a prompt</span></span>
<span class="giallo-l"><span class="z-storage z-type">let</span><span class="z-variable z-other"> model</span><span class="z-keyword"> =</span><span class="z-punctuation z-definition z-string"> &quot;</span><span class="z-string">gemma3:1b</span><span class="z-punctuation z-definition z-string">&quot;</span><span class="z-keyword">.</span><span class="z-entity z-name">to_string</span><span>(</span><span>)</span><span>;</span></span>
<span class="giallo-l"><span class="z-storage z-type">let</span><span class="z-variable z-other"> options</span><span class="z-keyword"> =</span><span class="z-entity z-name"> ModelOptions</span><span class="z-keyword">::</span><span class="z-entity z-name">default</span><span>(</span><span>)</span></span>
<span class="giallo-l"><span class="z-keyword">    .</span><span class="z-entity z-name">temperature</span><span>(</span><span class="z-constant">0</span><span class="z-constant">.</span><span class="z-constant">2</span><span>)</span></span>
<span class="giallo-l"><span class="z-keyword">    .</span><span class="z-entity z-name">top_k</span><span>(</span><span class="z-constant">25</span><span>)</span></span>
<span class="giallo-l"><span class="z-keyword">    .</span><span class="z-entity z-name">top_p</span><span>(</span><span class="z-constant">0</span><span class="z-constant">.</span><span class="z-constant">25</span><span>)</span><span>;</span></span>
<span class="giallo-l"><span class="z-storage z-type">let</span><span class="z-storage"> mut</span><span class="z-variable z-other"> prompt</span><span class="z-keyword"> =</span><span class="z-entity z-name"> format!</span><span>(</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string">    &quot;</span><span class="z-string">Answer the following user question: </span><span class="z-string">{</span><span class="z-string">query</span><span class="z-string">}</span><span class="z-constant">\</span><span class="z-constant">n</span><span class="z-constant">\</span><span class="z-constant">n</span><span class="z-string">Using the following information for context:</span><span class="z-constant">\</span><span class="z-constant">n</span><span class="z-constant">\</span><span class="z-constant">n</span><span class="z-punctuation z-definition z-string">&quot;</span></span>
<span class="giallo-l"><span>)</span><span>;</span></span>
<span class="giallo-l"><span class="z-variable z-other">results</span></span>
<span class="giallo-l"><span class="z-keyword">    .</span><span class="z-entity z-name">iter</span><span>(</span><span>)</span></span>
<span class="giallo-l"><span class="z-keyword">    .</span><span class="z-entity z-name">for_each</span><span>(</span><span class="z-keyword">|</span><span class="z-variable z-other">result</span><span class="z-keyword">|</span><span class="z-variable z-other"> prompt</span><span class="z-keyword">.</span><span class="z-entity z-name">push_str</span><span>(</span><span class="z-keyword">&amp;</span><span class="z-entity z-name">format!</span><span>(</span><span class="z-punctuation z-definition z-string">&quot;</span><span class="z-constant">\</span><span class="z-constant">n</span><span class="z-constant">\</span><span class="z-constant">n</span><span class="z-string">{</span><span class="z-string">}</span><span class="z-punctuation z-definition z-string">&quot;</span><span>,</span><span class="z-variable z-other"> result</span><span>)</span><span>)</span><span>)</span><span>;</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-comment">//</span><span class="z-comment"> Generate a streaming response</span></span>
<span class="giallo-l"><span class="z-storage z-type">let</span><span class="z-storage"> mut</span><span class="z-variable z-other"> stream</span><span class="z-keyword"> =</span><span class="z-variable z-other"> ollama</span></span>
<span class="giallo-l"><span class="z-keyword">    .</span><span class="z-entity z-name">generate_stream</span><span>(</span><span class="z-entity z-name">GenerationRequest</span><span class="z-keyword">::</span><span class="z-entity z-name">new</span><span>(</span><span class="z-variable z-other">model</span><span>,</span><span class="z-variable z-other"> prompt</span><span>)</span><span class="z-keyword">.</span><span class="z-entity z-name">options</span><span>(</span><span class="z-variable z-other">options</span><span>)</span><span>)</span></span>
<span class="giallo-l"><span class="z-keyword">    .</span><span class="z-keyword">await</span><span class="z-keyword">?</span><span>;</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-comment">//</span><span class="z-comment"> Stream the response to stdout</span></span>
<span class="giallo-l"><span class="z-storage z-type">let</span><span class="z-storage"> mut</span><span class="z-variable z-other"> stdout</span><span class="z-keyword"> =</span><span class="z-entity z-name"> io</span><span class="z-keyword">::</span><span class="z-entity z-name">stdout</span><span>(</span><span>)</span><span>;</span></span>
<span class="giallo-l"><span class="z-keyword">while</span><span class="z-storage z-type"> let</span><span class="z-entity z-name"> Some</span><span>(</span><span class="z-variable z-other">res</span><span>)</span><span class="z-keyword"> =</span><span class="z-variable z-other"> stream</span><span class="z-keyword">.</span><span class="z-entity z-name">next</span><span>(</span><span>)</span><span class="z-keyword">.</span><span class="z-keyword">await</span><span> {</span></span>
<span class="giallo-l"><span class="z-storage z-type">    let</span><span class="z-variable z-other"> responses</span><span class="z-keyword"> =</span><span class="z-variable z-other"> res</span><span class="z-keyword">?</span><span>;</span></span>
<span class="giallo-l"><span class="z-keyword">    for</span><span class="z-variable z-other"> resp</span><span class="z-keyword"> in</span><span class="z-variable z-other"> responses</span><span> {</span></span>
<span class="giallo-l"><span class="z-variable z-other">        stdout</span><span class="z-keyword">.</span><span class="z-entity z-name">write_all</span><span>(</span><span class="z-variable z-other">resp</span><span class="z-keyword">.</span><span>response</span><span class="z-keyword">.</span><span class="z-entity z-name">as_bytes</span><span>(</span><span>)</span><span>)</span><span class="z-keyword">.</span><span class="z-keyword">await</span><span class="z-keyword">?</span><span>;</span></span>
<span class="giallo-l"><span class="z-variable z-other">        stdout</span><span class="z-keyword">.</span><span class="z-entity z-name">flush</span><span>(</span><span>)</span><span class="z-keyword">.</span><span class="z-keyword">await</span><span class="z-keyword">?</span><span>;</span></span>
<span class="giallo-l"><span>    }</span></span>
<span class="giallo-l"><span>}</span></span></code></pre>
<p>The streaming interface provides immediate feedback, making the tool feel responsive even when the model is working on complex queries.</p>
<h2 id="usage">Usage<a class="zola-anchor" href="#usage" aria-label="Anchor link for: usage" style="visibility: hidden;"></a>
</h2>
<p>Let's walk through a typical interaction:</p>
<ol>
<li>
<p><strong>Initial Setup</strong>: I run <code>mdrag embed ~/vault</code> to process all my markdown files. This creates embeddings for each chunk and stores them in the SQLite database.</p>
</li>
<li>
<p><strong>Querying</strong>: When I want to find something, I run <code>mdrag search "how to debug git ssh issues"</code>. The system:</p>
<ul>
<li>Generates an embedding for my query</li>
<li>Finds the most similar chunks from my notes</li>
<li>Constructs a prompt with the query and context</li>
<li>Streams the AI-generated response</li>
</ul>
</li>
<li>
<p><strong>Getting Results</strong>: Instead of just showing me raw search results, I get a conversational answer that synthesizes information from multiple sources in my vault.</p>
</li>
</ol>
<p>For example, querying about Git SSH debugging would pull relevant snippets from my Git.md file and provide a comprehensive answer with the exact commands I've used before.</p>
<p>The system can also be modified to act as a chatbot, where users can ask follow-up questions and the system will use the context of the previous conversation for responses.</p>
<h2 id="local-first-approach">Local-First Approach<a class="zola-anchor" href="#local-first-approach" aria-label="Anchor link for: local-first-approach" style="visibility: hidden;"></a>
</h2>
<p>Running everything locally has several advantages:</p>
<ul>
<li><strong>Privacy</strong>: My notes never leave my machine - this is crucial for vaults that contain sensitive information like work-related notes</li>
<li><strong>Cost</strong>: No API costs for embeddings or inference (other than electricity üòÖ)</li>
<li><strong>Reliability</strong>: Works offline and doesn't depend on external services</li>
</ul>
<p>The performance is surprisingly good. Initial embedding takes a few seconds, and subsequent queries are nearly instantaneous. The SQLite vector search is remarkably fast, and the 1B parameter model provides good results without requiring expensive hardware.</p>

      </article>

      
      

      
      
    </div>

    


<footer>
  <div class="left">
    <div class="copyright">
      
      
    </div>
  </div>

  <div class="right">
    
    
      
    
    
    <a id="rss-btn" href="https://orellazri.com/atom.xml">RSS</a>
    
    

    
  </div>
</footer>




<dialog id="rss-mask">
  <div>
    <a href="https:&#x2F;&#x2F;orellazri.com&#x2F;atom.xml">https:&#x2F;&#x2F;orellazri.com&#x2F;atom.xml</a>
    
    
    <button autofocus aria-label="copy" data-link="https:&#x2F;&#x2F;orellazri.com&#x2F;atom.xml" data-copy-icon="&lt;svg xmlns=&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2000&#x2F;svg&quot; viewBox=&quot;0 0 24 24&quot; width=&quot;18&quot; height=&quot;18&quot;&gt;&lt;path d=&quot;M6.9998 6V3C6.9998 2.44772 7.44752 2 7.9998 2H19.9998C20.5521 2 20.9998 2.44772 20.9998 3V17C20.9998 17.5523 20.5521 18 19.9998 18H16.9998V20.9991C16.9998 21.5519 16.5499 22 15.993 22H4.00666C3.45059 22 3 21.5554 3 20.9991L3.0026 7.00087C3.0027 6.44811 3.45264 6 4.00942 6H6.9998ZM5.00242 8L5.00019 20H14.9998V8H5.00242ZM8.9998 6H16.9998V16H18.9998V4H8.9998V6Z&quot; fill=&quot;currentColor&quot;&gt;&lt;&#x2F;path&gt;&lt;&#x2F;svg&gt;
" data-check-icon="&lt;svg xmlns=&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2000&#x2F;svg&quot; viewBox=&quot;0 0 24 24&quot; width=&quot;18&quot; height=&quot;18&quot;&gt;&lt;path d=&quot;M10.0007 15.1709L19.1931 5.97852L20.6073 7.39273L10.0007 17.9993L3.63672 11.6354L5.05093 10.2212L10.0007 15.1709Z&quot; fill=&quot;currentColor&quot;&gt;&lt;&#x2F;path&gt;&lt;&#x2F;svg&gt;
" >
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18"><path d="M6.9998 6V3C6.9998 2.44772 7.44752 2 7.9998 2H19.9998C20.5521 2 20.9998 2.44772 20.9998 3V17C20.9998 17.5523 20.5521 18 19.9998 18H16.9998V20.9991C16.9998 21.5519 16.5499 22 15.993 22H4.00666C3.45059 22 3 21.5554 3 20.9991L3.0026 7.00087C3.0027 6.44811 3.45264 6 4.00942 6H6.9998ZM5.00242 8L5.00019 20H14.9998V8H5.00242ZM8.9998 6H16.9998V16H18.9998V4H8.9998V6Z" fill="currentColor"></path></svg>

    </button>
  </div>
</dialog>



  </main>
</div>

  
<script src="/js/lightense.min.js"></script>


  <script src="https://orellazri.com/js/main.js"></script>
</body>

</html>
