<!DOCTYPE html>
<html lang="en" class="dark light">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="base" content="https:&#x2F;&#x2F;orellazri.com">

    

    
    
    
    <title>
         Deploying Ingress Nginx on EKS With an Internal Load Balancer and HTTPS
        
    </title>

        
            <meta property="og:title" content="Deploying Ingress Nginx on EKS With an Internal Load Balancer and HTTPS" />
        
     

     
         
     

     
         
    

    
    
        <link rel="icon" type="image/png" href=&#x2F;favicon.svg />
    

    
    
        <link href=https://orellazri.com/fonts.css rel="stylesheet" />
    

    
    
        

        
            
            

            <script data-goatcounter="https://orellazri.goatcounter.com/count" async src="https://orellazri.com/js/count.js"></script>
            <noscript>
                
                <img src="https://orellazri.goatcounter.com//count?p=&#x2F;posts&#x2F;ingress-nginx-eks-internal-loadbalancer&#x2F;&t=Deploying Ingress Nginx on EKS With an Internal Load Balancer and HTTPS">
            </noscript>
        
    

    
    

    
    
        <script src=https://orellazri.com/js/toc.js></script>
    

    
    

    

    
    <link rel="alternate" type="application/atom+xml" title="Orel Lazri" href="https://orellazri.com/atom.xml">


    
    
        <link rel="stylesheet" type="text/css" href=https://orellazri.com/theme/light.css />
        <link rel="stylesheet" type="text/css" href="https://orellazri.com/theme/dark.css" media="(prefers-color-scheme: dark)" />
    

    <!-- Set the correct theme in the script -->
    <script src=https://orellazri.com/js/themetoggle.js></script>
    
        <script>
            if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
                setTheme("dark");
            } else {
                setTheme("light");
            }
        </script>
    

    <link rel="stylesheet" type="text/css" media="screen" href=https://orellazri.com/main.css />

    

    <script src=https://orellazri.com/js/mermaid.js></script>

    <script defer src="https://orellazri.com/search_index.en.js?h=3a69812dc9773e8d3635"></script>
        <script defer src="https://orellazri.com/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e"></script></head>


<body>
    <div class="content">
        <header>
    <div class="main">
        
            <a href=https:&#x2F;&#x2F;orellazri.com>Orel Lazri</a>
        


        <div class="socials">
            
            <a rel="me" href="https:&#x2F;&#x2F;github.com&#x2F;orellazri" class="social">
                <img alt=github src=https://orellazri.com/social_icons/github.svg>
            </a>
            
            <a rel="me" href="https:&#x2F;&#x2F;linkedin.com&#x2F;in&#x2F;orellazri" class="social">
                <img alt=linkedin src=https://orellazri.com/social_icons/linkedin.svg>
            </a>
            
        </div>
    </div>

    <nav>
        
            <a href=https://orellazri.com/posts style="margin-left: 0.25em">posts</a>
        
            <a href=https://orellazri.com/projects style="margin-left: 0.25em">projects</a>
        
            <a href=https://orellazri.com/atom.xml style="margin-left: 0.25em">rss</a>
        

        
        <button 
            id="search-button"
            class="search-button"
            title="$SHORTCUT to open search"
        >
            <img 
                src="https://orellazri.com/search.svg" 
                alt="Search" 
                class="search-icon"
            >
        </button>

        <div id="searchModal" class="search-modal js" role="dialog" aria-labelledby="modalTitle">
            <div id="modal-content">
                <h1 id="modalTitle" class="page-header">Search</h1>
                <div id="searchBar">
                    <input 
                        id="searchInput" 
                        role="combobox" 
                        autocomplete="off" 
                        spellcheck="false" 
                        aria-expanded="false" 
                        aria-controls="results-container" 
                        placeholder="Search..."
                    />
                    <button 
                        id="clear-search" 
                        class="clear-button"
                        title="Clear search"
                    >
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960">
                            <path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/>
                        </svg>
                    </button>
                </div>
                <div id="results-container">
                    <div id="results-info">
                        <span id="zero_results" style="display: none;">No results</span>
                        <span id="one_result" style="display: none;">1 result</span>
                        <span id="many_results" style="display: none;">$NUMBER results</span>
                    </div>
                    <div id="results" role="listbox"></div>
                </div>
            </div>
        </div>
        

        
    </nav>
</header>


        
        
    
<main>
    <article>
        <div class="title">
            
            
    <div class="page-header">
        Deploying Ingress Nginx on EKS With an Internal Load Balancer and HTTPS<span class="primary-color" style="font-size: 1.6em">.</span>
    </div>


                <div class="meta">
                    
                        Posted on <time>2024-03-31</time>
                    

                    

                    

                    
                    
                            <span class="tags-label"> :: Tags:</span>
                            <span class="tags">
                                    <a href="https://orellazri.com/tags/devops/" class="post-tag">devops</a>
                                
                            </span>
                    

                    
                    

                    

                </div>
        </div>

        

        
        
        
            <div class="toc-container">
                <h1 class="toc-title">Table of Contents</h1>
                <ul class="toc-list">
                    
                        <li>
                            <a href="https://orellazri.com/posts/ingress-nginx-eks-internal-loadbalancer/#prerequisites">Prerequisites</a>
                            
                        </li>
                    
                        <li>
                            <a href="https://orellazri.com/posts/ingress-nginx-eks-internal-loadbalancer/#deploy-ingress-nginx">Deploy Ingress Nginx</a>
                            
                        </li>
                    
                        <li>
                            <a href="https://orellazri.com/posts/ingress-nginx-eks-internal-loadbalancer/#create-an-ingress">Create an Ingress</a>
                            
                        </li>
                    
                </ul>
            </div>
        
        

        <section class="body">
            <p>In this post, we will deploy Ingress Nginx on EKS with an internal load balancer and HTTPS. This setup is useful when you want to expose your services an internal network (e.g. your work VPN) and secure the communication with HTTPS.</p>
<p>The TLS termination will be done by the NLB, so the traffic between the client and the load balancer will be encrypted.</p>
<h2 id="prerequisites"><a class="zola-anchor" href="#prerequisites" aria-label="Anchor link for: prerequisites">Prerequisites</a></h2>
<ul>
<li>An EKS cluster</li>
<li><code>kubectl</code> installed</li>
<li>SSL certificates in AWS ACM</li>
</ul>
<h2 id="deploy-ingress-nginx"><a class="zola-anchor" href="#deploy-ingress-nginx" aria-label="Anchor link for: deploy-ingress-nginx">Deploy Ingress Nginx</a></h2>
<p>First, we need to deploy Ingress Nginx. We will use the deployment files (I couldn't get the Helm chart to work properly since it was assigning the wrong target groups to the NLB).</p>
<p>Download the deploy.yaml file from the <a href="https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.10.0/deploy/static/provider/aws/nlb-with-tls-termination/deploy.yaml">official repository</a></p>
<p>Open the file, and modify the <code>proxy-real-ip-cidr: XXX.XXX.XXX/XX</code> field to match the VPC CIDR that your EKS cluster is using (e.g. 10.67.0.0/22).</p>
<p>You will also need to change <code>arn:aws:acm:us-west-2:XXXXXXXX:certificate/XXXXXX-XXXXXXX-XXXXXXX-XXXXXXXX</code> to match the ARN of your SSL certificate in AWS ACM.</p>
<p>Then, deploy the manifest:</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">kubectl</span><span> apply</span><span style="color:#bf616a;"> -f</span><span> deploy.yaml
</span></code></pre>
<p>This should create the Ingress Nginx controller and the necessary resources on K8s, along with an internal NLB on AWS.</p>
<h2 id="create-an-ingress"><a class="zola-anchor" href="#create-an-ingress" aria-label="Anchor link for: create-an-ingress">Create an Ingress</a></h2>
<p>To test the setup, create an Ingress resource that points to a service in your cluster.</p>
<pre data-lang="yaml" style="background-color:#2b303b;color:#c0c5ce;" class="language-yaml "><code class="language-yaml" data-lang="yaml"><span style="color:#bf616a;">apiVersion</span><span>: </span><span style="color:#a3be8c;">networking.k8s.io/v1
</span><span style="color:#bf616a;">kind</span><span>: </span><span style="color:#a3be8c;">Ingress
</span><span style="color:#bf616a;">metadata</span><span>:
</span><span>  </span><span style="color:#bf616a;">name</span><span>: </span><span style="color:#a3be8c;">my-ingress
</span><span style="color:#bf616a;">spec</span><span>:
</span><span>  </span><span style="color:#bf616a;">ingressClassName</span><span>: </span><span style="color:#a3be8c;">nginx
</span><span>  </span><span style="color:#bf616a;">rules</span><span>:
</span><span>    - </span><span style="color:#bf616a;">host</span><span>: </span><span style="color:#a3be8c;">my-host.example.com
</span><span>      </span><span style="color:#bf616a;">http</span><span>:
</span><span>        </span><span style="color:#bf616a;">paths</span><span>:
</span><span>          - </span><span style="color:#bf616a;">path</span><span>: </span><span style="color:#a3be8c;">/
</span><span>            </span><span style="color:#bf616a;">pathType</span><span>: </span><span style="color:#a3be8c;">Prefix
</span><span>            </span><span style="color:#bf616a;">backend</span><span>:
</span><span>              </span><span style="color:#bf616a;">service</span><span>:
</span><span>                </span><span style="color:#bf616a;">name</span><span>: </span><span style="color:#a3be8c;">my-service
</span><span>                </span><span style="color:#bf616a;">port</span><span>:
</span><span>                  </span><span style="color:#bf616a;">number</span><span>: </span><span style="color:#d08770;">80
</span></code></pre>
<p>Replace the <code>host</code> field with the domain you want to use, and the <code>service</code> field with the name of the service you want to expose (along with the correct port number).
Note that the <code>ingressClassName</code> field is set to <code>nginx</code>.</p>
<p>Then, apply the manifest:</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">kubectl</span><span> apply</span><span style="color:#bf616a;"> -f</span><span> ingress.yaml
</span></code></pre>

        </section>
    </article>
</main>



        
            
        

        
    </div>
</body>

</html>
