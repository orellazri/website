<!DOCTYPE html>

<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="color-scheme" content="light dark">
  
  
    
  
  <meta name="description" content="">

  <title>Deploying Ingress Nginx on EKS With an Internal Load Balancer and HTTPS</title>
  <link rel="icon" type="image/png" sizes="32x32" href="https://orellazri.com/img/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://orellazri.com/img/favicon-16x16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="https://orellazri.com/img/apple-touch-icon.png">
  <style>
@font-face {
  font-display: swap;
  font-family: 'Piazzolla';
  font-style: normal;
  font-weight: 400;
  src: url('/font/Piazzolla.woff2') format('woff2');
}
</style>

  <style>

  /* light mode colors */
  body {
    --primary-color: #5871a2;
    --primary-pale-color: #5871a233;
    --primary-decoration-color: #5871a210;
    --bg-color: #ffffff;
    --text-color: #2f3030;
    --text-pale-color: #767676;
    --text-decoration-color: #a9a9a9;
    --highlight-mark-color: #5f75b020;

    --callout-note-color: #5871a2;
    --callout-tip-color: #268556;
    --callout-important-color: #885fc9;
    --callout-warning-color: #ab6632;
    --callout-caution-color: #c64e4e;
  }

  /* dark mode colors */
  body.dark {
    --primary-color: #6f8fd1;
    --primary-pale-color: #6f8fd166;
    --primary-decoration-color: #6f8fd112;
    --bg-color: #2b2b38;
    --text-color: #c1c1c1;
    --text-pale-color: #848484;
    --text-decoration-color: #5f5f5f;
    --highlight-mark-color: #8296cb3b;

    --callout-note-color: #6f8fd1;
    --callout-tip-color: #47976f;
    --callout-important-color: #9776cd;
    --callout-warning-color: #ad7a52;
    --callout-caution-color: #d06161;
  }

  /* typography */
  body {
    --main-font: 'Piazzolla', serif;
    --code-font: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;
    --homepage-max-width: 768px;
    --main-max-width: 768px;
    --avatar-size: 50px;
    --font-size: 17px;
    --line-height: 1.75;
    --img-border-radius: 0px;
    --detail-border-radius: 0px;
    --dark-mode-img-brightness: 0.75;
    --dark-mode-chart-brightness: 0.75;
    --inline-code-border-radius: 2px;
    --inline-code-bg-color: var(--primary-decoration-color);
    --block-code-border-radius: 0px;
    --block-code-border-color: var(--primary-color);
    --detail-border-color: var(--primary-color);
  }

</style>

  <link rel="stylesheet" href="https://orellazri.com/main.css">
  

<link id="hl" rel="stylesheet" type="text/css" href="/giallo-dark.css" />



  <script data-goatcounter="https://orellazri.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>

</head>

<body class="post dark">
  
  
<div id="wrapper">
  <div id="blank"></div>
  <aside>
    
    
    <nav>
      <ul>
        
        <li>
          <a class="h2" href="#prerequisites">Prerequisites</a>
          
        </li>
        
        <li>
          <a class="h2" href="#deploy-ingress-nginx">Deploy Ingress Nginx</a>
          
        </li>
        
        <li>
          <a class="h2" href="#create-an-ingress">Create an Ingress</a>
          
        </li>
        
      </ul>
    </nav>
    
    
    <button id="back-to-top" aria-label="back to top">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-up"><line x1="12" y1="19" x2="12" y2="5"></line><polyline points="5 12 12 5 19 12"></polyline></svg>

    </button>
    
  </aside>
  <main>
    
<header>
  <nav>
    <a id="back-link" href="https:&#x2F;&#x2F;orellazri.com&#x2F;posts">‚Üê Back</a>
  </nav>
</header>


    <div>
      
      
      
      
      <div id="copy-cfg" style="display: none;" data-copy-icon="&lt;svg xmlns=&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2000&#x2F;svg&quot; viewBox=&quot;0 0 24 24&quot; width=&quot;18&quot; height=&quot;18&quot;&gt;&lt;path d=&quot;M6.9998 6V3C6.9998 2.44772 7.44752 2 7.9998 2H19.9998C20.5521 2 20.9998 2.44772 20.9998 3V17C20.9998 17.5523 20.5521 18 19.9998 18H16.9998V20.9991C16.9998 21.5519 16.5499 22 15.993 22H4.00666C3.45059 22 3 21.5554 3 20.9991L3.0026 7.00087C3.0027 6.44811 3.45264 6 4.00942 6H6.9998ZM5.00242 8L5.00019 20H14.9998V8H5.00242ZM8.9998 6H16.9998V16H18.9998V4H8.9998V6Z&quot; fill=&quot;currentColor&quot;&gt;&lt;&#x2F;path&gt;&lt;&#x2F;svg&gt;
" data-check-icon="&lt;svg xmlns=&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2000&#x2F;svg&quot; viewBox=&quot;0 0 24 24&quot; width=&quot;18&quot; height=&quot;18&quot;&gt;&lt;path d=&quot;M10.0007 15.1709L19.1931 5.97852L20.6073 7.39273L10.0007 17.9993L3.63672 11.6354L5.05093 10.2212L10.0007 15.1709Z&quot; fill=&quot;currentColor&quot;&gt;&lt;&#x2F;path&gt;&lt;&#x2F;svg&gt;
"></div>
      
      <article class="prose">
        <h1>Deploying Ingress Nginx on EKS With an Internal Load Balancer and HTTPS</h1>
        <div id="post-info">
          <div id="date">
            <span id="publish">Mar 31, 2024</span>
            </div>

          
          <div id="tags">
            <a class="instant" href="https://orellazri.com/tags/devops"><span>#</span>devops</a>
          </div>
          
        </div>

        
        

        

        <p>In this post, we will deploy Ingress Nginx on EKS with an internal load balancer and HTTPS. This setup is useful when you want to expose your services an internal network (e.g. your work VPN) and secure the communication with HTTPS.</p>
<p>The TLS termination will be done by the NLB, so the traffic between the client and the load balancer will be encrypted.</p>
<h2 id="prerequisites">Prerequisites<a class="zola-anchor" href="#prerequisites" aria-label="Anchor link for: prerequisites" style="visibility: hidden;"></a>
</h2>
<ul>
<li>An EKS cluster</li>
<li><code>kubectl</code> installed</li>
<li>SSL certificates in AWS ACM</li>
</ul>
<h2 id="deploy-ingress-nginx">Deploy Ingress Nginx<a class="zola-anchor" href="#deploy-ingress-nginx" aria-label="Anchor link for: deploy-ingress-nginx" style="visibility: hidden;"></a>
</h2>
<p>First, we need to deploy Ingress Nginx. We will use the deployment files (I couldn't get the Helm chart to work properly since it was assigning the wrong target groups to the NLB).</p>
<p>Download the deploy.yaml file from the <a rel="nofollow noreferrer external" href="https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.10.0/deploy/static/provider/aws/nlb-with-tls-termination/deploy.yaml">official repository</a></p>
<p>Open the file, and modify the <code>proxy-real-ip-cidr: XXX.XXX.XXX/XX</code> field to match the VPC CIDR that your EKS cluster is using (e.g. 10.67.0.0/22).</p>
<p>You will also need to change <code>arn:aws:acm:us-west-2:XXXXXXXX:certificate/XXXXXX-XXXXXXX-XXXXXXX-XXXXXXXX</code> to match the ARN of your SSL certificate in AWS ACM.</p>
<p>Then, deploy the manifest:</p>
<pre class="giallo z-code"><code data-lang="shellscript"><span class="giallo-l"><span class="z-entity z-name">kubectl</span><span class="z-string"> apply</span><span class="z-constant"> -</span><span class="z-constant">f</span><span class="z-string"> deploy.yaml</span></span></code></pre>
<p>This should create the Ingress Nginx controller and the necessary resources on K8s, along with an internal NLB on AWS.</p>
<h2 id="create-an-ingress">Create an Ingress<a class="zola-anchor" href="#create-an-ingress" aria-label="Anchor link for: create-an-ingress" style="visibility: hidden;"></a>
</h2>
<p>To test the setup, create an Ingress resource that points to a service in your cluster.</p>
<pre class="giallo z-code"><code data-lang="yaml"><span class="giallo-l"><span class="z-entity z-name z-tag">a</span><span class="z-entity z-name z-tag">piVersion</span><span>:</span><span class="z-string"> n</span><span class="z-string">etworking.k8s.io/v1</span></span>
<span class="giallo-l"><span class="z-entity z-name z-tag">k</span><span class="z-entity z-name z-tag">ind</span><span>:</span><span class="z-string"> I</span><span class="z-string">ngress</span></span>
<span class="giallo-l"><span class="z-entity z-name z-tag">m</span><span class="z-entity z-name z-tag">etadata</span><span>:</span></span>
<span class="giallo-l"><span class="z-entity z-name z-tag">  n</span><span class="z-entity z-name z-tag">ame</span><span>:</span><span class="z-string"> m</span><span class="z-string">y-ingress</span></span>
<span class="giallo-l"><span class="z-entity z-name z-tag">s</span><span class="z-entity z-name z-tag">pec</span><span>:</span></span>
<span class="giallo-l"><span class="z-entity z-name z-tag">  i</span><span class="z-entity z-name z-tag">ngressClassName</span><span>:</span><span class="z-string"> n</span><span class="z-string">ginx</span></span>
<span class="giallo-l"><span class="z-entity z-name z-tag">  r</span><span class="z-entity z-name z-tag">ules</span><span>:</span></span>
<span class="giallo-l"><span>    -</span><span class="z-entity z-name z-tag"> h</span><span class="z-entity z-name z-tag">ost</span><span>:</span><span class="z-string"> m</span><span class="z-string">y-host.example.com</span></span>
<span class="giallo-l"><span class="z-entity z-name z-tag">      h</span><span class="z-entity z-name z-tag">ttp</span><span>:</span></span>
<span class="giallo-l"><span class="z-entity z-name z-tag">        p</span><span class="z-entity z-name z-tag">aths</span><span>:</span></span>
<span class="giallo-l"><span>          -</span><span class="z-entity z-name z-tag"> p</span><span class="z-entity z-name z-tag">ath</span><span>:</span><span class="z-string"> /</span></span>
<span class="giallo-l"><span class="z-entity z-name z-tag">            p</span><span class="z-entity z-name z-tag">athType</span><span>:</span><span class="z-string"> P</span><span class="z-string">refix</span></span>
<span class="giallo-l"><span class="z-entity z-name z-tag">            b</span><span class="z-entity z-name z-tag">ackend</span><span>:</span></span>
<span class="giallo-l"><span class="z-entity z-name z-tag">              s</span><span class="z-entity z-name z-tag">ervice</span><span>:</span></span>
<span class="giallo-l"><span class="z-entity z-name z-tag">                n</span><span class="z-entity z-name z-tag">ame</span><span>:</span><span class="z-string"> m</span><span class="z-string">y-service</span></span>
<span class="giallo-l"><span class="z-entity z-name z-tag">                p</span><span class="z-entity z-name z-tag">ort</span><span>:</span></span>
<span class="giallo-l"><span class="z-entity z-name z-tag">                  n</span><span class="z-entity z-name z-tag">umber</span><span>:</span><span class="z-constant"> 80</span></span></code></pre>
<p>Replace the <code>host</code> field with the domain you want to use, and the <code>service</code> field with the name of the service you want to expose (along with the correct port number).
Note that the <code>ingressClassName</code> field is set to <code>nginx</code>.</p>
<p>Then, apply the manifest:</p>
<pre class="giallo z-code"><code data-lang="shellscript"><span class="giallo-l"><span class="z-entity z-name">kubectl</span><span class="z-string"> apply</span><span class="z-constant"> -</span><span class="z-constant">f</span><span class="z-string"> ingress.yaml</span></span></code></pre>
      </article>

      
      

      
      
    </div>

    


<footer>
  <div class="left">
    <div class="copyright">
      
      
    </div>
  </div>

  <div class="right">
    
    
      
    
    
    <a id="rss-btn" href="https://orellazri.com/atom.xml">RSS</a>
    
    

    
  </div>
</footer>




<dialog id="rss-mask">
  <div>
    <a href="https:&#x2F;&#x2F;orellazri.com&#x2F;atom.xml">https:&#x2F;&#x2F;orellazri.com&#x2F;atom.xml</a>
    
    
    <button autofocus aria-label="copy" data-link="https:&#x2F;&#x2F;orellazri.com&#x2F;atom.xml" data-copy-icon="&lt;svg xmlns=&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2000&#x2F;svg&quot; viewBox=&quot;0 0 24 24&quot; width=&quot;18&quot; height=&quot;18&quot;&gt;&lt;path d=&quot;M6.9998 6V3C6.9998 2.44772 7.44752 2 7.9998 2H19.9998C20.5521 2 20.9998 2.44772 20.9998 3V17C20.9998 17.5523 20.5521 18 19.9998 18H16.9998V20.9991C16.9998 21.5519 16.5499 22 15.993 22H4.00666C3.45059 22 3 21.5554 3 20.9991L3.0026 7.00087C3.0027 6.44811 3.45264 6 4.00942 6H6.9998ZM5.00242 8L5.00019 20H14.9998V8H5.00242ZM8.9998 6H16.9998V16H18.9998V4H8.9998V6Z&quot; fill=&quot;currentColor&quot;&gt;&lt;&#x2F;path&gt;&lt;&#x2F;svg&gt;
" data-check-icon="&lt;svg xmlns=&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2000&#x2F;svg&quot; viewBox=&quot;0 0 24 24&quot; width=&quot;18&quot; height=&quot;18&quot;&gt;&lt;path d=&quot;M10.0007 15.1709L19.1931 5.97852L20.6073 7.39273L10.0007 17.9993L3.63672 11.6354L5.05093 10.2212L10.0007 15.1709Z&quot; fill=&quot;currentColor&quot;&gt;&lt;&#x2F;path&gt;&lt;&#x2F;svg&gt;
" >
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18"><path d="M6.9998 6V3C6.9998 2.44772 7.44752 2 7.9998 2H19.9998C20.5521 2 20.9998 2.44772 20.9998 3V17C20.9998 17.5523 20.5521 18 19.9998 18H16.9998V20.9991C16.9998 21.5519 16.5499 22 15.993 22H4.00666C3.45059 22 3 21.5554 3 20.9991L3.0026 7.00087C3.0027 6.44811 3.45264 6 4.00942 6H6.9998ZM5.00242 8L5.00019 20H14.9998V8H5.00242ZM8.9998 6H16.9998V16H18.9998V4H8.9998V6Z" fill="currentColor"></path></svg>

    </button>
  </div>
</dialog>



  </main>
</div>

  
<script src="/js/lightense.min.js"></script>


  <script src="https://orellazri.com/js/main.js"></script>
</body>

</html>
