<!DOCTYPE html>

<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="color-scheme" content="light dark">
  
  
    
  
  <meta name="description" content="">

  <title>Implementing a MongoDB CRUD API Using Go Generics</title>
  <link rel="icon" type="image/png" sizes="32x32" href="https://orellazri.com/img/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://orellazri.com/img/favicon-16x16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="https://orellazri.com/img/apple-touch-icon.png">
  <style>
@font-face {
  font-display: swap;
  font-family: 'Piazzolla';
  font-style: normal;
  font-weight: 400;
  src: url('/font/Piazzolla.woff2') format('woff2');
}
</style>

  <style>

  /* light mode colors */
  body {
    --primary-color: #5871a2;
    --primary-pale-color: #5871a233;
    --primary-decoration-color: #5871a210;
    --bg-color: #ffffff;
    --text-color: #2f3030;
    --text-pale-color: #767676;
    --text-decoration-color: #a9a9a9;
    --highlight-mark-color: #5f75b020;

    --callout-note-color: #5871a2;
    --callout-tip-color: #268556;
    --callout-important-color: #885fc9;
    --callout-warning-color: #ab6632;
    --callout-caution-color: #c64e4e;
  }

  /* dark mode colors */
  body.dark {
    --primary-color: #6f8fd1;
    --primary-pale-color: #6f8fd166;
    --primary-decoration-color: #6f8fd112;
    --bg-color: #2b2b38;
    --text-color: #c1c1c1;
    --text-pale-color: #848484;
    --text-decoration-color: #5f5f5f;
    --highlight-mark-color: #8296cb3b;

    --callout-note-color: #6f8fd1;
    --callout-tip-color: #47976f;
    --callout-important-color: #9776cd;
    --callout-warning-color: #ad7a52;
    --callout-caution-color: #d06161;
  }

  /* typography */
  body {
    --main-font: 'Piazzolla', serif;
    --code-font: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;
    --homepage-max-width: 768px;
    --main-max-width: 768px;
    --avatar-size: 50px;
    --font-size: 17px;
    --line-height: 1.75;
    --img-border-radius: 0px;
    --detail-border-radius: 0px;
    --dark-mode-img-brightness: 0.75;
    --dark-mode-chart-brightness: 0.75;
    --inline-code-border-radius: 2px;
    --inline-code-bg-color: var(--primary-decoration-color);
    --block-code-border-radius: 0px;
    --block-code-border-color: var(--primary-color);
    --detail-border-color: var(--primary-color);
  }

</style>

  <link rel="stylesheet" href="https://orellazri.com/main.css">
  

<link id="hl" rel="stylesheet" type="text/css" href="/giallo-dark.css" />



  <script data-goatcounter="https://orellazri.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>

</head>

<body class="post dark">
  
  
<div id="wrapper">
  <div id="blank"></div>
  <aside>
    
    
    <nav>
      <ul>
        
        <li>
          <a class="h2" href="#go-generics-to-the-rescue">Go Generics to the Rescue</a>
          
        </li>
        
        <li>
          <a class="h2" href="#the-models">The Models</a>
          
        </li>
        
        <li>
          <a class="h2" href="#a-naive-approach">A Naive Approach</a>
          
        </li>
        
        <li>
          <a class="h2" href="#a-generic-approach">A Generic Approach</a>
          
          <ul>
            
            <li>
              <a class="h3" href="#service">Service</a>
            </li>
            
            <li>
              <a class="h3" href="#controller">Controller</a>
            </li>
            
          </ul>
          
        </li>
        
        <li>
          <a class="h2" href="#tying-it-all-together">Tying It All Together</a>
          
        </li>
        
      </ul>
    </nav>
    
    
    <button id="back-to-top" aria-label="back to top">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-up"><line x1="12" y1="19" x2="12" y2="5"></line><polyline points="5 12 12 5 19 12"></polyline></svg>

    </button>
    
  </aside>
  <main>
    
<header>
  <nav>
    <a id="back-link" href="https:&#x2F;&#x2F;orellazri.com&#x2F;posts">‚Üê Back</a>
  </nav>
</header>


    <div>
      
      
      
      
      <div id="copy-cfg" style="display: none;" data-copy-icon="&lt;svg xmlns=&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2000&#x2F;svg&quot; viewBox=&quot;0 0 24 24&quot; width=&quot;18&quot; height=&quot;18&quot;&gt;&lt;path d=&quot;M6.9998 6V3C6.9998 2.44772 7.44752 2 7.9998 2H19.9998C20.5521 2 20.9998 2.44772 20.9998 3V17C20.9998 17.5523 20.5521 18 19.9998 18H16.9998V20.9991C16.9998 21.5519 16.5499 22 15.993 22H4.00666C3.45059 22 3 21.5554 3 20.9991L3.0026 7.00087C3.0027 6.44811 3.45264 6 4.00942 6H6.9998ZM5.00242 8L5.00019 20H14.9998V8H5.00242ZM8.9998 6H16.9998V16H18.9998V4H8.9998V6Z&quot; fill=&quot;currentColor&quot;&gt;&lt;&#x2F;path&gt;&lt;&#x2F;svg&gt;
" data-check-icon="&lt;svg xmlns=&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2000&#x2F;svg&quot; viewBox=&quot;0 0 24 24&quot; width=&quot;18&quot; height=&quot;18&quot;&gt;&lt;path d=&quot;M10.0007 15.1709L19.1931 5.97852L20.6073 7.39273L10.0007 17.9993L3.63672 11.6354L5.05093 10.2212L10.0007 15.1709Z&quot; fill=&quot;currentColor&quot;&gt;&lt;&#x2F;path&gt;&lt;&#x2F;svg&gt;
"></div>
      
      <article class="prose">
        <h1>Implementing a MongoDB CRUD API Using Go Generics</h1>
        <div id="post-info">
          <div id="date">
            <span id="publish">May 11, 2024</span>
            </div>

          
          <div id="tags">
            <a class="instant" href="https://orellazri.com/tags/coding"><span>#</span>coding</a>
          </div>
          
        </div>

        
        

        

        <p>I had to write a simple CRUD REST API for a project I'm working on that contains quite a bit of database models in MongoDB. I started writing a controller and a service for each model, but I quickly realized that I was writing the same code over and over again.</p>
<p>Surely there must be a better way to do this.</p>
<h2 id="go-generics-to-the-rescue">Go Generics to the Rescue<a class="zola-anchor" href="#go-generics-to-the-rescue" aria-label="Anchor link for: go-generics-to-the-rescue" style="visibility: hidden;"></a>
</h2>
<p>Go 1.18 introduced <a rel="nofollow noreferrer external" href="https://go.dev/doc/tutorial/generics">generics</a>, which allows you to write functions and data structures that can work with any type.</p>
<p>This is perfect for my use case. I can write a generic controller and service that can work with any model, as long as the input and output are the same as the model struct. This of course won't work for every use case, but for simple CRUD resources, it's perfect.</p>
<h2 id="the-models">The Models<a class="zola-anchor" href="#the-models" aria-label="Anchor link for: the-models" style="visibility: hidden;"></a>
</h2>
<p>Let's start by defining a simple model named <code>Post</code> under <code>models/models.go</code>:</p>
<pre class="giallo z-code"><code data-lang="go"><span class="giallo-l"><span class="z-keyword">package</span><span class="z-entity z-name"> models</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-keyword">import</span><span class="z-punctuation z-definition z-string"> &quot;</span><span class="z-entity z-name">go.mongodb.org/mongo-driver/bson/primitive</span><span class="z-punctuation z-definition z-string">&quot;</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-keyword">type</span><span class="z-entity z-name"> Post</span><span class="z-keyword"> struct</span><span> {</span></span>
<span class="giallo-l"><span class="z-variable z-other">  ID</span><span class="z-entity z-name">    primitive</span><span>.</span><span class="z-entity z-name">ObjectID</span><span class="z-punctuation z-definition z-string"> `</span><span class="z-string">bson:&quot;_id,omitempty&quot; json:&quot;id,omitempty&quot;</span><span class="z-punctuation z-definition z-string">`</span></span>
<span class="giallo-l"><span class="z-variable z-other">  Title</span><span class="z-storage z-type"> string</span><span class="z-punctuation z-definition z-string">             `</span><span class="z-string">bson:&quot;title&quot; json:&quot;title&quot;</span><span class="z-punctuation z-definition z-string">`</span></span>
<span class="giallo-l"><span class="z-variable z-other">  Body</span><span class="z-storage z-type">  string</span><span class="z-punctuation z-definition z-string">             `</span><span class="z-string">bson:&quot;body&quot; json:&quot;body&quot;</span><span class="z-punctuation z-definition z-string">`</span></span>
<span class="giallo-l"><span>}</span></span></code></pre>
<p>Note that each field has a <code>bson</code> tag for MongoDB and a <code>json</code> tag for the API.</p>
<h2 id="a-naive-approach">A Naive Approach<a class="zola-anchor" href="#a-naive-approach" aria-label="Anchor link for: a-naive-approach" style="visibility: hidden;"></a>
</h2>
<p>Here's what a naive controller and service would look like for the <code>Post</code> model:</p>
<pre class="giallo z-code"><code data-lang="go"><span class="giallo-l"><span class="z-keyword">package</span><span class="z-entity z-name"> controllers</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-keyword">type</span><span class="z-entity z-name"> PostsController</span><span class="z-keyword"> struct</span><span> {</span></span>
<span class="giallo-l"><span class="z-variable z-other">  service</span><span class="z-keyword"> *</span><span class="z-entity z-name">services</span><span>.</span><span class="z-entity z-name">PostsService</span></span>
<span class="giallo-l"><span>}</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-keyword">func</span><span class="z-entity z-name"> NewPostsController</span><span>(</span><span class="z-variable">service</span><span class="z-keyword"> *</span><span class="z-entity z-name">services</span><span>.</span><span class="z-entity z-name">PostsService</span><span>)</span><span class="z-keyword"> *</span><span class="z-entity z-name">PostsController</span><span> {</span></span>
<span class="giallo-l"><span class="z-keyword">  return</span><span class="z-keyword"> &amp;</span><span class="z-entity z-name">PostsController</span><span>{</span><span class="z-variable z-other">service</span><span>}</span></span>
<span class="giallo-l"><span>}</span></span></code></pre>
<p>And the service:</p>
<pre class="giallo z-code"><code data-lang="go"><span class="giallo-l"></span>
<span class="giallo-l"><span class="z-keyword">type</span><span class="z-entity z-name"> PostsService</span><span class="z-keyword"> struct</span><span> {</span></span>
<span class="giallo-l"><span class="z-variable z-other">  db</span><span class="z-keyword"> *</span><span class="z-entity z-name">mongo</span><span>.</span><span class="z-entity z-name">Database</span></span>
<span class="giallo-l"><span>}</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-keyword">func</span><span class="z-entity z-name"> NewPostsService</span><span>(</span><span class="z-variable">db</span><span class="z-keyword"> *</span><span class="z-entity z-name">mongo</span><span>.</span><span class="z-entity z-name">Database</span><span>)</span><span class="z-keyword"> *</span><span class="z-entity z-name">PostsService</span><span> {</span></span>
<span class="giallo-l"><span class="z-keyword">  return</span><span class="z-keyword"> &amp;</span><span class="z-entity z-name">PostsService</span><span>{</span><span class="z-variable z-other">db</span><span>}</span></span>
<span class="giallo-l"><span>}</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-keyword">func</span><span> (</span><span class="z-variable">s </span><span class="z-keyword">*</span><span class="z-entity z-name">PostsService</span><span>)</span><span class="z-entity z-name"> List</span><span>(</span><span class="z-variable">ctx</span><span class="z-entity z-name"> context</span><span>.</span><span class="z-entity z-name">Context</span><span>)</span><span> (</span><span>[</span><span>]</span><span class="z-entity z-name">models</span><span>.</span><span class="z-entity z-name">Post</span><span>,</span><span class="z-storage z-type"> error</span><span>)</span><span> {</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-comment">  //</span><span class="z-comment"> -- snip --</span></span>
<span class="giallo-l"><span>}</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-keyword">func</span><span> (</span><span class="z-variable">s </span><span class="z-keyword">*</span><span class="z-entity z-name">PostsService</span><span>)</span><span class="z-entity z-name"> Create</span><span>(</span><span class="z-variable">ctx</span><span class="z-entity z-name"> context</span><span>.</span><span class="z-entity z-name">Context</span><span>,</span><span class="z-variable"> post</span><span class="z-keyword"> *</span><span class="z-entity z-name">models</span><span>.</span><span class="z-entity z-name">Post</span><span>)</span><span> (</span><span class="z-keyword">*</span><span class="z-entity z-name">models</span><span>.</span><span class="z-entity z-name">Post</span><span>,</span><span class="z-storage z-type"> error</span><span>)</span><span> {</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-comment">  //</span><span class="z-comment"> -- snip --</span></span>
<span class="giallo-l"><span>}</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-keyword">func</span><span> (</span><span class="z-variable">s </span><span class="z-keyword">*</span><span class="z-entity z-name">PostsService</span><span>)</span><span class="z-entity z-name"> Get</span><span>(</span><span class="z-variable">ctx</span><span class="z-entity z-name"> context</span><span>.</span><span class="z-entity z-name">Context</span><span>,</span><span class="z-variable"> id</span><span class="z-storage z-type"> string</span><span>)</span><span> (</span><span class="z-keyword">*</span><span class="z-entity z-name">models</span><span>.</span><span class="z-entity z-name">Post</span><span>,</span><span class="z-storage z-type"> error</span><span>)</span><span> {</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-comment">  //</span><span class="z-comment"> -- snip --</span></span>
<span class="giallo-l"><span>}</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-keyword">func</span><span> (</span><span class="z-variable">s </span><span class="z-keyword">*</span><span class="z-entity z-name">PostsService</span><span>)</span><span class="z-entity z-name"> Update</span><span>(</span><span class="z-variable">ctx</span><span class="z-entity z-name"> context</span><span>.</span><span class="z-entity z-name">Context</span><span>,</span><span class="z-variable"> id</span><span class="z-storage z-type"> string</span><span>,</span><span class="z-variable"> post</span><span class="z-keyword"> *</span><span class="z-entity z-name">models</span><span>.</span><span class="z-entity z-name">Post</span><span>)</span><span> (</span><span class="z-keyword">*</span><span class="z-entity z-name">models</span><span>.</span><span class="z-entity z-name">Post</span><span>,</span><span class="z-storage z-type"> error</span><span>)</span><span> {</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-comment">  //</span><span class="z-comment"> -- snip --</span></span>
<span class="giallo-l"><span>}</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-keyword">func</span><span> (</span><span class="z-variable">s </span><span class="z-keyword">*</span><span class="z-entity z-name">PostsService</span><span>)</span><span class="z-entity z-name"> Delete</span><span>(</span><span class="z-variable">ctx</span><span class="z-entity z-name"> context</span><span>.</span><span class="z-entity z-name">Context</span><span>,</span><span class="z-variable"> id</span><span class="z-storage z-type"> string</span><span>)</span><span class="z-storage z-type"> error</span><span> {</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-comment">  //</span><span class="z-comment"> -- snip --</span></span>
<span class="giallo-l"><span>}</span></span></code></pre>
<p>We can clearly see how repetitive this code is. We can do better.</p>
<h2 id="a-generic-approach">A Generic Approach<a class="zola-anchor" href="#a-generic-approach" aria-label="Anchor link for: a-generic-approach" style="visibility: hidden;"></a>
</h2>
<h3 id="service">Service<a class="zola-anchor" href="#service" aria-label="Anchor link for: service" style="visibility: hidden;"></a>
</h3>
<p>We'll start out by defining a generic service that can work with any model:</p>
<pre class="giallo z-code"><code data-lang="go"><span class="giallo-l"><span class="z-keyword">package</span><span class="z-entity z-name"> services</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-keyword">import</span><span> (</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string">	&quot;</span><span class="z-entity z-name">context</span><span class="z-punctuation z-definition z-string">&quot;</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string">	&quot;</span><span class="z-entity z-name">go.mongodb.org/mongo-driver/bson</span><span class="z-punctuation z-definition z-string">&quot;</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string">	&quot;</span><span class="z-entity z-name">go.mongodb.org/mongo-driver/bson/primitive</span><span class="z-punctuation z-definition z-string">&quot;</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string">	&quot;</span><span class="z-entity z-name">go.mongodb.org/mongo-driver/mongo</span><span class="z-punctuation z-definition z-string">&quot;</span></span>
<span class="giallo-l"><span>)</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-keyword">type</span><span class="z-entity z-name"> CrudService</span><span>[</span><span class="z-variable">T</span><span class="z-entity z-name"> any</span><span>]</span><span class="z-keyword"> struct</span><span> {</span></span>
<span class="giallo-l"><span class="z-variable z-other">	db</span><span class="z-keyword">         *</span><span class="z-entity z-name">mongo</span><span>.</span><span class="z-entity z-name">Database</span></span>
<span class="giallo-l"><span class="z-variable z-other">	collection</span><span class="z-storage z-type"> string</span></span>
<span class="giallo-l"><span>}</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-keyword">func</span><span class="z-entity z-name"> NewCrudService</span><span>[</span><span class="z-variable">T</span><span class="z-entity z-name"> any</span><span>]</span><span>(</span><span class="z-variable">db</span><span class="z-keyword"> *</span><span class="z-entity z-name">mongo</span><span>.</span><span class="z-entity z-name">Database</span><span>,</span><span class="z-variable"> collection</span><span class="z-storage z-type"> string</span><span>)</span><span class="z-keyword"> *</span><span class="z-entity z-name">CrudService</span><span>[</span><span class="z-entity z-name">T</span><span>]</span><span> {</span></span>
<span class="giallo-l"><span class="z-keyword">	return</span><span class="z-keyword"> &amp;</span><span class="z-entity z-name">CrudService</span><span>[</span><span class="z-entity z-name">T</span><span>]</span><span>{</span></span>
<span class="giallo-l"><span class="z-variable z-other">		db</span><span>,</span></span>
<span class="giallo-l"><span class="z-variable z-other">		collection</span><span>,</span></span>
<span class="giallo-l"><span>	}</span></span>
<span class="giallo-l"><span>}</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-keyword">func</span><span> (</span><span class="z-variable">s </span><span class="z-keyword">*</span><span class="z-entity z-name">CrudService</span><span>[</span><span class="z-entity z-name">T</span><span>]</span><span>)</span><span class="z-entity z-name"> List</span><span>(</span><span class="z-variable">ctx</span><span class="z-entity z-name"> context</span><span>.</span><span class="z-entity z-name">Context</span><span>)</span><span> (</span><span>[</span><span>]</span><span class="z-entity z-name">T</span><span>,</span><span class="z-storage z-type"> error</span><span>)</span><span> {</span></span>
<span class="giallo-l"><span class="z-variable z-other">	cursor</span><span>,</span><span class="z-variable z-other"> err</span><span class="z-keyword"> :=</span><span class="z-variable z-other"> s</span><span>.</span><span class="z-variable z-other">db</span><span>.</span><span class="z-entity z-name">Collection</span><span>(</span><span class="z-variable z-other">s</span><span>.</span><span class="z-variable z-other">collection</span><span>)</span><span>.</span><span class="z-entity z-name">Find</span><span>(</span><span class="z-variable z-other">ctx</span><span>,</span><span class="z-entity z-name"> bson</span><span>.</span><span class="z-entity z-name">D</span><span>{</span><span>}</span><span>)</span></span>
<span class="giallo-l"><span class="z-keyword">	if</span><span class="z-variable z-other"> err</span><span class="z-keyword"> !=</span><span class="z-constant"> nil</span><span> {</span></span>
<span class="giallo-l"><span class="z-keyword">		return</span><span class="z-constant"> nil</span><span>,</span><span class="z-variable z-other"> err</span></span>
<span class="giallo-l"><span>	}</span></span>
<span class="giallo-l"><span class="z-keyword">	var</span><span class="z-variable z-other"> results</span><span> [</span><span>]</span><span class="z-entity z-name">T</span></span>
<span class="giallo-l"><span class="z-keyword">	if</span><span class="z-variable z-other"> err</span><span class="z-keyword"> =</span><span class="z-variable z-other"> cursor</span><span>.</span><span class="z-entity z-name">All</span><span>(</span><span class="z-variable z-other">ctx</span><span>,</span><span class="z-keyword"> &amp;</span><span class="z-variable z-other">results</span><span>)</span><span>;</span><span class="z-variable z-other"> err</span><span class="z-keyword"> !=</span><span class="z-constant"> nil</span><span> {</span></span>
<span class="giallo-l"><span class="z-keyword">		return</span><span class="z-constant"> nil</span><span>,</span><span class="z-variable z-other"> err</span></span>
<span class="giallo-l"><span>	}</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-keyword">	return</span><span class="z-variable z-other"> results</span><span>,</span><span class="z-constant"> nil</span></span>
<span class="giallo-l"><span>}</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-keyword">func</span><span> (</span><span class="z-variable">s </span><span class="z-keyword">*</span><span class="z-entity z-name">CrudService</span><span>[</span><span class="z-entity z-name">T</span><span>]</span><span>)</span><span class="z-entity z-name"> Create</span><span>(</span><span class="z-variable">ctx</span><span class="z-entity z-name"> context</span><span>.</span><span class="z-entity z-name">Context</span><span>,</span><span class="z-variable"> input</span><span class="z-entity z-name"> T</span><span>)</span><span> (</span><span class="z-entity z-name">primitive</span><span>.</span><span class="z-entity z-name">ObjectID</span><span>,</span><span class="z-storage z-type"> error</span><span>)</span><span> {</span></span>
<span class="giallo-l"><span class="z-variable z-other">	result</span><span>,</span><span class="z-variable z-other"> err</span><span class="z-keyword"> :=</span><span class="z-variable z-other"> s</span><span>.</span><span class="z-variable z-other">db</span><span>.</span><span class="z-entity z-name">Collection</span><span>(</span><span class="z-variable z-other">s</span><span>.</span><span class="z-variable z-other">collection</span><span>)</span><span>.</span><span class="z-entity z-name">InsertOne</span><span>(</span><span class="z-variable z-other">ctx</span><span>,</span><span class="z-variable z-other"> input</span><span>)</span></span>
<span class="giallo-l"><span class="z-keyword">	if</span><span class="z-variable z-other"> err</span><span class="z-keyword"> !=</span><span class="z-constant"> nil</span><span> {</span></span>
<span class="giallo-l"><span class="z-keyword">		return</span><span class="z-entity z-name"> primitive</span><span>.</span><span class="z-entity z-name">ObjectID</span><span>{</span><span>}</span><span>,</span><span class="z-variable z-other"> err</span></span>
<span class="giallo-l"><span>	}</span></span>
<span class="giallo-l"><span class="z-variable z-other">	resultId</span><span>,</span><span class="z-variable z-other"> ok</span><span class="z-keyword"> :=</span><span class="z-variable z-other"> result</span><span>.</span><span class="z-variable z-other">InsertedID</span><span>.</span><span>(</span><span class="z-entity z-name">primitive</span><span>.</span><span class="z-entity z-name">ObjectID</span><span>)</span></span>
<span class="giallo-l"><span class="z-keyword">	if</span><span class="z-keyword"> !</span><span class="z-variable z-other">ok</span><span> {</span></span>
<span class="giallo-l"><span class="z-keyword">		return</span><span class="z-entity z-name"> primitive</span><span>.</span><span class="z-entity z-name">ObjectID</span><span>{</span><span>}</span><span>,</span><span class="z-variable z-other"> err</span></span>
<span class="giallo-l"><span>	}</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-keyword">	return</span><span class="z-variable z-other"> resultId</span><span>,</span><span class="z-constant"> nil</span></span>
<span class="giallo-l"><span>}</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-keyword">func</span><span> (</span><span class="z-variable">s </span><span class="z-keyword">*</span><span class="z-entity z-name">CrudService</span><span>[</span><span class="z-entity z-name">T</span><span>]</span><span>)</span><span class="z-entity z-name"> Get</span><span>(</span><span class="z-variable">ctx</span><span class="z-entity z-name"> context</span><span>.</span><span class="z-entity z-name">Context</span><span>,</span><span class="z-variable"> id</span><span class="z-storage z-type"> string</span><span>)</span><span> (</span><span class="z-keyword">*</span><span class="z-entity z-name">T</span><span>,</span><span class="z-storage z-type"> error</span><span>)</span><span> {</span></span>
<span class="giallo-l"><span class="z-variable z-other">	objectId</span><span>,</span><span class="z-variable z-other"> err</span><span class="z-keyword"> :=</span><span class="z-variable z-other"> primitive</span><span>.</span><span class="z-entity z-name">ObjectIDFromHex</span><span>(</span><span class="z-variable z-other">id</span><span>)</span></span>
<span class="giallo-l"><span class="z-keyword">	if</span><span class="z-variable z-other"> err</span><span class="z-keyword"> !=</span><span class="z-constant"> nil</span><span> {</span></span>
<span class="giallo-l"><span class="z-keyword">		return</span><span class="z-constant"> nil</span><span>,</span><span class="z-variable z-other"> err</span></span>
<span class="giallo-l"><span>	}</span></span>
<span class="giallo-l"><span class="z-keyword">	var</span><span class="z-variable z-other"> result</span><span class="z-entity z-name"> T</span></span>
<span class="giallo-l"><span class="z-variable z-other">	err</span><span class="z-keyword"> =</span><span class="z-variable z-other"> s</span><span>.</span><span class="z-variable z-other">db</span><span>.</span><span class="z-entity z-name">Collection</span><span>(</span><span class="z-variable z-other">s</span><span>.</span><span class="z-variable z-other">collection</span><span>)</span><span>.</span><span class="z-entity z-name">FindOne</span><span>(</span><span class="z-variable z-other">ctx</span><span>,</span><span class="z-entity z-name"> bson</span><span>.</span><span class="z-entity z-name">M</span><span>{</span><span class="z-punctuation z-definition z-string">&quot;</span><span class="z-string">_id</span><span class="z-punctuation z-definition z-string">&quot;</span><span>:</span><span class="z-variable z-other"> objectId</span><span>}</span><span>)</span><span>.</span><span class="z-entity z-name">Decode</span><span>(</span><span class="z-keyword">&amp;</span><span class="z-variable z-other">result</span><span>)</span></span>
<span class="giallo-l"><span class="z-keyword">	if</span><span class="z-variable z-other"> err</span><span class="z-keyword"> !=</span><span class="z-constant"> nil</span><span> {</span></span>
<span class="giallo-l"><span class="z-keyword">		return</span><span class="z-constant"> nil</span><span>,</span><span class="z-variable z-other"> err</span></span>
<span class="giallo-l"><span>	}</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-keyword">	return</span><span class="z-keyword"> &amp;</span><span class="z-variable z-other">result</span><span>,</span><span class="z-constant"> nil</span></span>
<span class="giallo-l"><span>}</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-keyword">func</span><span> (</span><span class="z-variable">s </span><span class="z-keyword">*</span><span class="z-entity z-name">CrudService</span><span>[</span><span class="z-entity z-name">T</span><span>]</span><span>)</span><span class="z-entity z-name"> Update</span><span>(</span><span class="z-variable">ctx</span><span class="z-entity z-name"> context</span><span>.</span><span class="z-entity z-name">Context</span><span>,</span><span class="z-variable"> id</span><span class="z-storage z-type"> string</span><span>,</span><span class="z-variable"> input</span><span class="z-entity z-name"> T</span><span>)</span><span> (</span><span class="z-entity z-name">primitive</span><span>.</span><span class="z-entity z-name">ObjectID</span><span>,</span><span class="z-storage z-type"> error</span><span>)</span><span> {</span></span>
<span class="giallo-l"><span class="z-variable z-other">	objectId</span><span>,</span><span class="z-variable z-other"> err</span><span class="z-keyword"> :=</span><span class="z-variable z-other"> primitive</span><span>.</span><span class="z-entity z-name">ObjectIDFromHex</span><span>(</span><span class="z-variable z-other">id</span><span>)</span></span>
<span class="giallo-l"><span class="z-keyword">	if</span><span class="z-variable z-other"> err</span><span class="z-keyword"> !=</span><span class="z-constant"> nil</span><span> {</span></span>
<span class="giallo-l"><span class="z-keyword">		return</span><span class="z-entity z-name"> primitive</span><span>.</span><span class="z-entity z-name">ObjectID</span><span>{</span><span>}</span><span>,</span><span class="z-variable z-other"> err</span></span>
<span class="giallo-l"><span>	}</span></span>
<span class="giallo-l"><span class="z-variable z-other">	filter</span><span class="z-keyword"> :=</span><span class="z-entity z-name"> bson</span><span>.</span><span class="z-entity z-name">M</span><span>{</span><span class="z-punctuation z-definition z-string">&quot;</span><span class="z-string">_id</span><span class="z-punctuation z-definition z-string">&quot;</span><span>:</span><span class="z-variable z-other"> objectId</span><span>}</span></span>
<span class="giallo-l"><span class="z-variable z-other">	update</span><span class="z-keyword"> :=</span><span class="z-entity z-name"> bson</span><span>.</span><span class="z-entity z-name">M</span><span>{</span><span class="z-punctuation z-definition z-string">&quot;</span><span class="z-string">$set</span><span class="z-punctuation z-definition z-string">&quot;</span><span>:</span><span class="z-variable z-other"> input</span><span>}</span></span>
<span class="giallo-l"><span class="z-variable z-other">	_</span><span>,</span><span class="z-variable z-other"> err</span><span class="z-keyword"> =</span><span class="z-variable z-other"> s</span><span>.</span><span class="z-variable z-other">db</span><span>.</span><span class="z-entity z-name">Collection</span><span>(</span><span class="z-variable z-other">s</span><span>.</span><span class="z-variable z-other">collection</span><span>)</span><span>.</span><span class="z-entity z-name">UpdateOne</span><span>(</span><span class="z-variable z-other">ctx</span><span>,</span><span class="z-variable z-other"> filter</span><span>,</span><span class="z-variable z-other"> update</span><span>)</span></span>
<span class="giallo-l"><span class="z-keyword">	if</span><span class="z-variable z-other"> err</span><span class="z-keyword"> !=</span><span class="z-constant"> nil</span><span> {</span></span>
<span class="giallo-l"><span class="z-keyword">		return</span><span class="z-entity z-name"> primitive</span><span>.</span><span class="z-entity z-name">ObjectID</span><span>{</span><span>}</span><span>,</span><span class="z-variable z-other"> err</span></span>
<span class="giallo-l"><span>	}</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-keyword">	return</span><span class="z-variable z-other"> objectId</span><span>,</span><span class="z-constant"> nil</span></span>
<span class="giallo-l"><span>}</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-keyword">func</span><span> (</span><span class="z-variable">s </span><span class="z-keyword">*</span><span class="z-entity z-name">CrudService</span><span>[</span><span class="z-entity z-name">T</span><span>]</span><span>)</span><span class="z-entity z-name"> Delete</span><span>(</span><span class="z-variable">ctx</span><span class="z-entity z-name"> context</span><span>.</span><span class="z-entity z-name">Context</span><span>,</span><span class="z-variable"> id</span><span class="z-storage z-type"> string</span><span>)</span><span class="z-storage z-type"> error</span><span> {</span></span>
<span class="giallo-l"><span class="z-variable z-other">	objectId</span><span>,</span><span class="z-variable z-other"> err</span><span class="z-keyword"> :=</span><span class="z-variable z-other"> primitive</span><span>.</span><span class="z-entity z-name">ObjectIDFromHex</span><span>(</span><span class="z-variable z-other">id</span><span>)</span></span>
<span class="giallo-l"><span class="z-keyword">	if</span><span class="z-variable z-other"> err</span><span class="z-keyword"> !=</span><span class="z-constant"> nil</span><span> {</span></span>
<span class="giallo-l"><span class="z-keyword">		return</span><span class="z-variable z-other"> err</span></span>
<span class="giallo-l"><span>	}</span></span>
<span class="giallo-l"><span class="z-variable z-other">	filter</span><span class="z-keyword"> :=</span><span class="z-entity z-name"> bson</span><span>.</span><span class="z-entity z-name">M</span><span>{</span><span class="z-punctuation z-definition z-string">&quot;</span><span class="z-string">_id</span><span class="z-punctuation z-definition z-string">&quot;</span><span>:</span><span class="z-variable z-other"> objectId</span><span>}</span></span>
<span class="giallo-l"><span class="z-variable z-other">	_</span><span>,</span><span class="z-variable z-other"> err</span><span class="z-keyword"> =</span><span class="z-variable z-other"> s</span><span>.</span><span class="z-variable z-other">db</span><span>.</span><span class="z-entity z-name">Collection</span><span>(</span><span class="z-variable z-other">s</span><span>.</span><span class="z-variable z-other">collection</span><span>)</span><span>.</span><span class="z-entity z-name">DeleteOne</span><span>(</span><span class="z-variable z-other">ctx</span><span>,</span><span class="z-variable z-other"> filter</span><span>)</span></span>
<span class="giallo-l"><span class="z-keyword">	if</span><span class="z-variable z-other"> err</span><span class="z-keyword"> !=</span><span class="z-constant"> nil</span><span> {</span></span>
<span class="giallo-l"><span class="z-keyword">		return</span><span class="z-variable z-other"> err</span></span>
<span class="giallo-l"><span>	}</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-keyword">	return</span><span class="z-constant"> nil</span></span>
<span class="giallo-l"><span>}</span></span>
<span class="giallo-l"></span></code></pre>
<p>This service accepts the collection name as a parameter so it knows which collection to work with.</p>
<pre class="giallo z-code"><code data-lang="go"><span class="giallo-l"><span class="z-keyword">type</span><span class="z-entity z-name"> CrudService</span><span>[</span><span class="z-variable">T</span><span class="z-entity z-name"> any</span><span>]</span><span class="z-keyword"> struct</span><span> {</span></span>
<span class="giallo-l"><span class="z-variable z-other">	db</span><span class="z-keyword">         *</span><span class="z-entity z-name">mongo</span><span>.</span><span class="z-entity z-name">Database</span></span>
<span class="giallo-l"><span class="z-variable z-other">	collection</span><span class="z-storage z-type"> string</span></span>
<span class="giallo-l"><span>}</span></span></code></pre>
<p>This is the generic service struct. It accepts a type <code>T</code> which can be any type (in our case, a <code>Post</code> model).</p>
<pre class="giallo z-code"><code data-lang="go"><span class="giallo-l"><span class="z-keyword">func</span><span> (</span><span class="z-variable">s </span><span class="z-keyword">*</span><span class="z-entity z-name">CrudService</span><span>[</span><span class="z-entity z-name">T</span><span>]</span><span>)</span><span class="z-entity z-name"> List</span><span>(</span><span class="z-variable">ctx</span><span class="z-entity z-name"> context</span><span>.</span><span class="z-entity z-name">Context</span><span>)</span><span> (</span><span>[</span><span>]</span><span class="z-entity z-name">T</span><span>,</span><span class="z-storage z-type"> error</span><span>)</span><span> {</span></span></code></pre>
<p>The functions are defined with the same type <code>T</code> that the service struct accepts, so in this context everywhere you see <code>T</code>, think of it as the <code>Post</code> model.</p>
<h3 id="controller">Controller<a class="zola-anchor" href="#controller" aria-label="Anchor link for: controller" style="visibility: hidden;"></a>
</h3>
<p>As for the controller, we will define a generic controller that will contain the service:</p>
<pre class="giallo z-code"><code data-lang="go"><span class="giallo-l"><span class="z-keyword">package</span><span class="z-entity z-name"> controllers</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-keyword">type</span><span class="z-entity z-name"> CrudController</span><span>[</span><span class="z-variable">T</span><span class="z-entity z-name"> any</span><span>]</span><span class="z-keyword"> struct</span><span> {</span></span>
<span class="giallo-l"><span class="z-variable z-other">	crudService</span><span class="z-keyword"> *</span><span class="z-entity z-name">services</span><span>.</span><span class="z-entity z-name">CrudService</span><span>[</span><span class="z-entity z-name">T</span><span>]</span></span>
<span class="giallo-l"><span>}</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-keyword">func</span><span class="z-entity z-name"> NewCrudController</span><span>[</span><span class="z-variable">T</span><span class="z-entity z-name"> any</span><span>]</span><span>(</span><span class="z-variable">group</span><span class="z-keyword"> *</span><span class="z-entity z-name">echo</span><span>.</span><span class="z-entity z-name">Group</span><span>,</span><span class="z-variable"> db</span><span class="z-keyword"> *</span><span class="z-entity z-name">mongo</span><span>.</span><span class="z-entity z-name">Database</span><span>,</span><span class="z-variable"> collection</span><span class="z-storage z-type"> string</span><span>)</span><span class="z-keyword"> *</span><span class="z-entity z-name">CrudController</span><span>[</span><span class="z-entity z-name">T</span><span>]</span><span> {</span></span>
<span class="giallo-l"><span class="z-variable z-other">	c</span><span class="z-keyword"> :=</span><span class="z-keyword"> &amp;</span><span class="z-entity z-name">CrudController</span><span>[</span><span class="z-entity z-name">T</span><span>]</span><span>{</span></span>
<span class="giallo-l"><span class="z-variable z-other">		services</span><span>.</span><span class="z-entity z-name">NewCrudService</span><span>[</span><span class="z-entity z-name">T</span><span>]</span><span>(</span><span class="z-variable z-other">db</span><span>,</span><span class="z-variable z-other"> collection</span><span>)</span><span>,</span></span>
<span class="giallo-l"><span>	}</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-variable z-other">	group</span><span>.</span><span class="z-entity z-name">GET</span><span>(</span><span class="z-punctuation z-definition z-string">&quot;</span><span class="z-punctuation z-definition z-string">&quot;</span><span>,</span><span class="z-variable z-other"> c</span><span>.</span><span class="z-variable z-other">List</span><span>)</span></span>
<span class="giallo-l"><span class="z-variable z-other">	group</span><span>.</span><span class="z-entity z-name">POST</span><span>(</span><span class="z-punctuation z-definition z-string">&quot;</span><span class="z-punctuation z-definition z-string">&quot;</span><span>,</span><span class="z-variable z-other"> c</span><span>.</span><span class="z-variable z-other">Create</span><span>)</span></span>
<span class="giallo-l"><span class="z-variable z-other">	group</span><span>.</span><span class="z-entity z-name">GET</span><span>(</span><span class="z-punctuation z-definition z-string">&quot;</span><span class="z-string">/:id</span><span class="z-punctuation z-definition z-string">&quot;</span><span>,</span><span class="z-variable z-other"> c</span><span>.</span><span class="z-variable z-other">Get</span><span>)</span></span>
<span class="giallo-l"><span class="z-variable z-other">	group</span><span>.</span><span class="z-entity z-name">PUT</span><span>(</span><span class="z-punctuation z-definition z-string">&quot;</span><span class="z-string">/:id</span><span class="z-punctuation z-definition z-string">&quot;</span><span>,</span><span class="z-variable z-other"> c</span><span>.</span><span class="z-variable z-other">Update</span><span>)</span></span>
<span class="giallo-l"><span class="z-variable z-other">	group</span><span>.</span><span class="z-entity z-name">DELETE</span><span>(</span><span class="z-punctuation z-definition z-string">&quot;</span><span class="z-string">/:id</span><span class="z-punctuation z-definition z-string">&quot;</span><span>,</span><span class="z-variable z-other"> c</span><span>.</span><span class="z-variable z-other">Delete</span><span>)</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-keyword">	return</span><span class="z-variable z-other"> c</span></span>
<span class="giallo-l"><span>}</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-keyword">func</span><span> (</span><span class="z-variable">c </span><span class="z-keyword">*</span><span class="z-entity z-name">CrudController</span><span>[</span><span class="z-entity z-name">T</span><span>]</span><span>)</span><span class="z-entity z-name"> List</span><span>(</span><span class="z-variable">ctx</span><span class="z-entity z-name"> echo</span><span>.</span><span class="z-entity z-name">Context</span><span>)</span><span class="z-storage z-type"> error</span><span> {</span></span>
<span class="giallo-l"><span class="z-variable z-other">	results</span><span>,</span><span class="z-variable z-other"> err</span><span class="z-keyword"> :=</span><span class="z-variable z-other"> c</span><span>.</span><span class="z-variable z-other">crudService</span><span>.</span><span class="z-entity z-name">List</span><span>(</span><span class="z-variable z-other">ctx</span><span>.</span><span class="z-entity z-name">Request</span><span>(</span><span>)</span><span>.</span><span class="z-entity z-name">Context</span><span>(</span><span>)</span><span>)</span></span>
<span class="giallo-l"><span class="z-keyword">	if</span><span class="z-variable z-other"> err</span><span class="z-keyword"> !=</span><span class="z-constant"> nil</span><span> {</span></span>
<span class="giallo-l"><span class="z-keyword">		return</span><span class="z-variable z-other"> err</span></span>
<span class="giallo-l"><span>	}</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-keyword">	return</span><span class="z-variable z-other"> ctx</span><span>.</span><span class="z-entity z-name">JSON</span><span>(</span><span class="z-constant">200</span><span>,</span><span class="z-variable z-other"> results</span><span>)</span></span>
<span class="giallo-l"><span>}</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-keyword">func</span><span> (</span><span class="z-variable">c </span><span class="z-keyword">*</span><span class="z-entity z-name">CrudController</span><span>[</span><span class="z-entity z-name">T</span><span>]</span><span>)</span><span class="z-entity z-name"> Create</span><span>(</span><span class="z-variable">ctx</span><span class="z-entity z-name"> echo</span><span>.</span><span class="z-entity z-name">Context</span><span>)</span><span class="z-storage z-type"> error</span><span> {</span></span>
<span class="giallo-l"><span class="z-keyword">	var</span><span class="z-variable z-other"> input</span><span class="z-entity z-name"> T</span></span>
<span class="giallo-l"><span class="z-keyword">	if</span><span class="z-variable z-other"> err</span><span class="z-keyword"> :=</span><span class="z-variable z-other"> ctx</span><span>.</span><span class="z-entity z-name">Bind</span><span>(</span><span class="z-keyword">&amp;</span><span class="z-variable z-other">input</span><span>)</span><span>;</span><span class="z-variable z-other"> err</span><span class="z-keyword"> !=</span><span class="z-constant"> nil</span><span> {</span></span>
<span class="giallo-l"><span class="z-keyword">		return</span><span class="z-variable z-other"> err</span></span>
<span class="giallo-l"><span>	}</span></span>
<span class="giallo-l"><span class="z-variable z-other">	result</span><span>,</span><span class="z-variable z-other"> err</span><span class="z-keyword"> :=</span><span class="z-variable z-other"> c</span><span>.</span><span class="z-variable z-other">crudService</span><span>.</span><span class="z-entity z-name">Create</span><span>(</span><span class="z-variable z-other">ctx</span><span>.</span><span class="z-entity z-name">Request</span><span>(</span><span>)</span><span>.</span><span class="z-entity z-name">Context</span><span>(</span><span>)</span><span>,</span><span class="z-variable z-other"> input</span><span>)</span></span>
<span class="giallo-l"><span class="z-keyword">	if</span><span class="z-variable z-other"> err</span><span class="z-keyword"> !=</span><span class="z-constant"> nil</span><span> {</span></span>
<span class="giallo-l"><span class="z-keyword">		return</span><span class="z-variable z-other"> err</span></span>
<span class="giallo-l"><span>	}</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-keyword">	return</span><span class="z-variable z-other"> ctx</span><span>.</span><span class="z-entity z-name">JSON</span><span>(</span><span class="z-constant">201</span><span>,</span><span class="z-variable z-other"> result</span><span>)</span></span>
<span class="giallo-l"><span>}</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-keyword">func</span><span> (</span><span class="z-variable">c </span><span class="z-keyword">*</span><span class="z-entity z-name">CrudController</span><span>[</span><span class="z-entity z-name">T</span><span>]</span><span>)</span><span class="z-entity z-name"> Get</span><span>(</span><span class="z-variable">ctx</span><span class="z-entity z-name"> echo</span><span>.</span><span class="z-entity z-name">Context</span><span>)</span><span class="z-storage z-type"> error</span><span> {</span></span>
<span class="giallo-l"><span class="z-variable z-other">	id</span><span class="z-keyword"> :=</span><span class="z-variable z-other"> ctx</span><span>.</span><span class="z-entity z-name">Param</span><span>(</span><span class="z-punctuation z-definition z-string">&quot;</span><span class="z-string">id</span><span class="z-punctuation z-definition z-string">&quot;</span><span>)</span></span>
<span class="giallo-l"><span class="z-variable z-other">	result</span><span>,</span><span class="z-variable z-other"> err</span><span class="z-keyword"> :=</span><span class="z-variable z-other"> c</span><span>.</span><span class="z-variable z-other">crudService</span><span>.</span><span class="z-entity z-name">Get</span><span>(</span><span class="z-variable z-other">ctx</span><span>.</span><span class="z-entity z-name">Request</span><span>(</span><span>)</span><span>.</span><span class="z-entity z-name">Context</span><span>(</span><span>)</span><span>,</span><span class="z-variable z-other"> id</span><span>)</span></span>
<span class="giallo-l"><span class="z-keyword">	if</span><span class="z-variable z-other"> err</span><span class="z-keyword"> !=</span><span class="z-constant"> nil</span><span> {</span></span>
<span class="giallo-l"><span class="z-keyword">		return</span><span class="z-variable z-other"> err</span></span>
<span class="giallo-l"><span>	}</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-keyword">	return</span><span class="z-variable z-other"> ctx</span><span>.</span><span class="z-entity z-name">JSON</span><span>(</span><span class="z-constant">200</span><span>,</span><span class="z-variable z-other"> result</span><span>)</span></span>
<span class="giallo-l"><span>}</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-keyword">func</span><span> (</span><span class="z-variable">c </span><span class="z-keyword">*</span><span class="z-entity z-name">CrudController</span><span>[</span><span class="z-entity z-name">T</span><span>]</span><span>)</span><span class="z-entity z-name"> Update</span><span>(</span><span class="z-variable">ctx</span><span class="z-entity z-name"> echo</span><span>.</span><span class="z-entity z-name">Context</span><span>)</span><span class="z-storage z-type"> error</span><span> {</span></span>
<span class="giallo-l"><span class="z-variable z-other">	id</span><span class="z-keyword"> :=</span><span class="z-variable z-other"> ctx</span><span>.</span><span class="z-entity z-name">Param</span><span>(</span><span class="z-punctuation z-definition z-string">&quot;</span><span class="z-string">id</span><span class="z-punctuation z-definition z-string">&quot;</span><span>)</span></span>
<span class="giallo-l"><span class="z-keyword">	var</span><span class="z-variable z-other"> input</span><span class="z-entity z-name"> T</span></span>
<span class="giallo-l"><span class="z-keyword">	if</span><span class="z-variable z-other"> err</span><span class="z-keyword"> :=</span><span class="z-variable z-other"> ctx</span><span>.</span><span class="z-entity z-name">Bind</span><span>(</span><span class="z-keyword">&amp;</span><span class="z-variable z-other">input</span><span>)</span><span>;</span><span class="z-variable z-other"> err</span><span class="z-keyword"> !=</span><span class="z-constant"> nil</span><span> {</span></span>
<span class="giallo-l"><span class="z-keyword">		return</span><span class="z-variable z-other"> err</span></span>
<span class="giallo-l"><span>	}</span></span>
<span class="giallo-l"><span class="z-variable z-other">	result</span><span>,</span><span class="z-variable z-other"> err</span><span class="z-keyword"> :=</span><span class="z-variable z-other"> c</span><span>.</span><span class="z-variable z-other">crudService</span><span>.</span><span class="z-entity z-name">Update</span><span>(</span><span class="z-variable z-other">ctx</span><span>.</span><span class="z-entity z-name">Request</span><span>(</span><span>)</span><span>.</span><span class="z-entity z-name">Context</span><span>(</span><span>)</span><span>,</span><span class="z-variable z-other"> id</span><span>,</span><span class="z-variable z-other"> input</span><span>)</span></span>
<span class="giallo-l"><span class="z-keyword">	if</span><span class="z-variable z-other"> err</span><span class="z-keyword"> !=</span><span class="z-constant"> nil</span><span> {</span></span>
<span class="giallo-l"><span class="z-keyword">		return</span><span class="z-variable z-other"> err</span></span>
<span class="giallo-l"><span>	}</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-keyword">	return</span><span class="z-variable z-other"> ctx</span><span>.</span><span class="z-entity z-name">JSON</span><span>(</span><span class="z-constant">200</span><span>,</span><span class="z-variable z-other"> result</span><span>)</span></span>
<span class="giallo-l"><span>}</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-keyword">func</span><span> (</span><span class="z-variable">c </span><span class="z-keyword">*</span><span class="z-entity z-name">CrudController</span><span>[</span><span class="z-entity z-name">T</span><span>]</span><span>)</span><span class="z-entity z-name"> Delete</span><span>(</span><span class="z-variable">ctx</span><span class="z-entity z-name"> echo</span><span>.</span><span class="z-entity z-name">Context</span><span>)</span><span class="z-storage z-type"> error</span><span> {</span></span>
<span class="giallo-l"><span class="z-variable z-other">	id</span><span class="z-keyword"> :=</span><span class="z-variable z-other"> ctx</span><span>.</span><span class="z-entity z-name">Param</span><span>(</span><span class="z-punctuation z-definition z-string">&quot;</span><span class="z-string">id</span><span class="z-punctuation z-definition z-string">&quot;</span><span>)</span></span>
<span class="giallo-l"><span class="z-variable z-other">	err</span><span class="z-keyword"> :=</span><span class="z-variable z-other"> c</span><span>.</span><span class="z-variable z-other">crudService</span><span>.</span><span class="z-entity z-name">Delete</span><span>(</span><span class="z-variable z-other">ctx</span><span>.</span><span class="z-entity z-name">Request</span><span>(</span><span>)</span><span>.</span><span class="z-entity z-name">Context</span><span>(</span><span>)</span><span>,</span><span class="z-variable z-other"> id</span><span>)</span></span>
<span class="giallo-l"><span class="z-keyword">	if</span><span class="z-variable z-other"> err</span><span class="z-keyword"> !=</span><span class="z-constant"> nil</span><span> {</span></span>
<span class="giallo-l"><span class="z-keyword">		return</span><span class="z-variable z-other"> err</span></span>
<span class="giallo-l"><span>	}</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-keyword">	return</span><span class="z-variable z-other"> ctx</span><span>.</span><span class="z-entity z-name">NoContent</span><span>(</span><span class="z-constant">200</span><span>)</span></span>
<span class="giallo-l"><span>}</span></span></code></pre>
<p>This controller registers the routes for the CRUD operations and calls the service methods. Note that I'm using Echo as my web framework of choice, but this will work with any other web framework or router.</p>
<h2 id="tying-it-all-together">Tying It All Together<a class="zola-anchor" href="#tying-it-all-together" aria-label="Anchor link for: tying-it-all-together" style="visibility: hidden;"></a>
</h2>
<p>In the main file, where we start our HTTP server and connect to the database, we can now use the generic controller to create a controller for the <code>Post</code> model:</p>
<pre class="giallo z-code"><code data-lang="go"><span class="giallo-l"><span class="z-keyword">func</span><span class="z-entity z-name"> main</span><span>(</span><span>)</span><span> {</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-comment">	//</span><span class="z-comment"> -- snip --</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-comment">	//</span><span class="z-comment"> Controllers</span></span>
<span class="giallo-l"><span class="z-variable z-other">	apiGroup</span><span class="z-keyword"> :=</span><span class="z-variable z-other"> e</span><span>.</span><span class="z-entity z-name">Group</span><span>(</span><span class="z-punctuation z-definition z-string">&quot;</span><span class="z-string">/api</span><span class="z-punctuation z-definition z-string">&quot;</span><span>)</span></span>
<span class="giallo-l"><span class="z-variable z-other">	controllers</span><span>.</span><span class="z-entity z-name">NewCrudController</span><span>[</span><span class="z-entity z-name">models</span><span>.</span><span class="z-entity z-name">Post</span><span>]</span><span>(</span><span class="z-variable z-other">apiGroup</span><span>.</span><span class="z-entity z-name">Group</span><span>(</span><span class="z-punctuation z-definition z-string">&quot;</span><span class="z-string">/posts</span><span class="z-punctuation z-definition z-string">&quot;</span><span>)</span><span>,</span><span class="z-variable z-other"> db</span><span>,</span><span class="z-punctuation z-definition z-string"> &quot;</span><span class="z-string">posts</span><span class="z-punctuation z-definition z-string">&quot;</span><span>)</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-comment">	//</span><span class="z-comment"> as many controllers as you want...</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-comment">	//</span><span class="z-comment"> -- snip --</span></span>
<span class="giallo-l"><span>}</span></span></code></pre>
<p>Here you can see how scalable this approach is. You can create as many controllers as you want for different models, and you don't have to write any more service or controller code, unless you need to add custom logic.</p>
<p>Generics are a powerful feature that can help you write more scalable and maintainable code. In this example, we used generics to create a generic CRUD service and controller that can work with any model. This approach is perfect for simple CRUD resources, but it might not work for more complex use cases.</p>
<p>This is a simple example, and I can easily see use cases where the controller and service can be extended to handle more complex logic like pagination, filtering, and more.</p>

      </article>

      
      

      
      
    </div>

    


<footer>
  <div class="left">
    <div class="copyright">
      
      
    </div>
  </div>

  <div class="right">
    
    
      
    
    
    <a id="rss-btn" href="https://orellazri.com/atom.xml">RSS</a>
    
    

    
  </div>
</footer>




<dialog id="rss-mask">
  <div>
    <a href="https:&#x2F;&#x2F;orellazri.com&#x2F;atom.xml">https:&#x2F;&#x2F;orellazri.com&#x2F;atom.xml</a>
    
    
    <button autofocus aria-label="copy" data-link="https:&#x2F;&#x2F;orellazri.com&#x2F;atom.xml" data-copy-icon="&lt;svg xmlns=&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2000&#x2F;svg&quot; viewBox=&quot;0 0 24 24&quot; width=&quot;18&quot; height=&quot;18&quot;&gt;&lt;path d=&quot;M6.9998 6V3C6.9998 2.44772 7.44752 2 7.9998 2H19.9998C20.5521 2 20.9998 2.44772 20.9998 3V17C20.9998 17.5523 20.5521 18 19.9998 18H16.9998V20.9991C16.9998 21.5519 16.5499 22 15.993 22H4.00666C3.45059 22 3 21.5554 3 20.9991L3.0026 7.00087C3.0027 6.44811 3.45264 6 4.00942 6H6.9998ZM5.00242 8L5.00019 20H14.9998V8H5.00242ZM8.9998 6H16.9998V16H18.9998V4H8.9998V6Z&quot; fill=&quot;currentColor&quot;&gt;&lt;&#x2F;path&gt;&lt;&#x2F;svg&gt;
" data-check-icon="&lt;svg xmlns=&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2000&#x2F;svg&quot; viewBox=&quot;0 0 24 24&quot; width=&quot;18&quot; height=&quot;18&quot;&gt;&lt;path d=&quot;M10.0007 15.1709L19.1931 5.97852L20.6073 7.39273L10.0007 17.9993L3.63672 11.6354L5.05093 10.2212L10.0007 15.1709Z&quot; fill=&quot;currentColor&quot;&gt;&lt;&#x2F;path&gt;&lt;&#x2F;svg&gt;
" >
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18"><path d="M6.9998 6V3C6.9998 2.44772 7.44752 2 7.9998 2H19.9998C20.5521 2 20.9998 2.44772 20.9998 3V17C20.9998 17.5523 20.5521 18 19.9998 18H16.9998V20.9991C16.9998 21.5519 16.5499 22 15.993 22H4.00666C3.45059 22 3 21.5554 3 20.9991L3.0026 7.00087C3.0027 6.44811 3.45264 6 4.00942 6H6.9998ZM5.00242 8L5.00019 20H14.9998V8H5.00242ZM8.9998 6H16.9998V16H18.9998V4H8.9998V6Z" fill="currentColor"></path></svg>

    </button>
  </div>
</dialog>



  </main>
</div>

  
<script src="/js/lightense.min.js"></script>


  <script src="https://orellazri.com/js/main.js"></script>
</body>

</html>
